
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 3 页 | 元气糯米团子的Coding Blog</title>
  <meta name="author" content="zhiqiang he">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="元气糯米团子的Coding Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="元气糯米团子的Coding Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/assets/css/toc.css"/>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>-->
  <script type="text/javascript" src="//upcdn.b0.upaiyun.com/libs/jquery/jquery-1.8.3.min.js"></script>
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png" />
  <link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16" />
  <meta name="msapplication-TileColor" content="#da532c" />
  <!--
  <SCRIPT type=text/javascript src="/js/scrolltop.js"></SCRIPT>
   -->
  <!--howiefh calendar begin-->
  <SCRIPT type=text/javascript src="/js/calendar.js"></SCRIPT>
  <!--howiefh calendar end-->
  
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-53429135-1', 'auto');
    ga('send', 'pageview');
</script>

</head>


<body>
<header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">元气糯米团子的Coding Blog</a></h1>
  <h2><a href="/">Tansform information as knowledges, extract and purify as thoughts</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">树根</a></li>
    
      <li><a href="/archives">泡菜坛子</a></li>
    
      <li><a href="/links">连接</a></li>
    
      <li><a href="/atom.xml">粽子</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>

<div id="content" class="inner">
    <div id="main-col" class="alignleft">
        <div id="wrapper">
  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-29T12:15:28.000Z"><a href="/2014/12/29/ejabberd-using-mix-to-compile-ejabberd-module/">2014-12-29</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/29/ejabberd-using-mix-to-compile-ejabberd-module/">使用Elixir Mix编译Ejabberd模块</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>本文是基于Github上的一个项目的实践, 该项目包含了Ejabberd 14.07的头文件, 直接把开发好的模块放在<code>src</code>目录下,并执行:</p>
<p>克隆项目:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># git clone https://github.com/scrogson/ejabberd_dev.git&#10;Cloning into &#39;ejabberd_dev&#39;...&#10;remote: Counting objects: 39, done.&#10;remote: Total 39 (delta 0), reused 0 (delta 0)&#10;Unpacking objects: 100% (39/39), done.&#10;Checking connectivity... done.</span><br></pre></td></tr></table></figure>
<p>进入项目目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ejabberd_dev</span><br></pre></td></tr></table></figure>
<p>编译:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix do deps.get, compile</span><br></pre></td></tr></table></figure>
<p>即可编译模块, 编译的Beam文件生成到<code>_build</code>目录中.</p>
<h2 id="TODO:">TODO:</h2><ul>
<li>开发一个Elixir Mix任务,把编译好的Beam文件复制到Ejabberd的部署目录</li>
<li>开发一个Elixir Mix任务, 用于更新Ejabberd新版本的头文件到<code>ejabberd_dev</code>项目目录</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-29T07:19:37.000Z"><a href="/2014/12/29/sequelize-create-index-in-v2/">2014-12-29</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/29/sequelize-create-index-in-v2/">Sequelize 定义索引</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>Node的ORM框架Sequelize 2.0版本支持在模型定义文件中定义索引的创建, 2.0之前的版本, 需要通过Migration的方式创建.</p>
<h2 id="V1-7版本的创建方式">V1.7版本的创建方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">migration.addIndex(&#39;partner&#39;, [&#39;name&#39;, &#39;cellphone&#39;])</span><br></pre></td></tr></table></figure>
<h2 id="V2版本的创建方式">V2版本的创建方式</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">sequelize, DataTypes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> partner = sequelize.define(<span class="string">'partner'</span>, &#123;</span><br><span class="line">    id: &#123;</span><br><span class="line">      type: DataTypes.INTEGER,</span><br><span class="line">      primaryKey: <span class="literal">true</span>,</span><br><span class="line">      autoIncrement: <span class="literal">true</span>,</span><br><span class="line">      comment: <span class="string">'合作伙伴ID'</span>,</span><br><span class="line">      allowNull: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: &#123;</span><br><span class="line">      type: DataTypes.STRING(<span class="number">32</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span>,</span><br><span class="line">      comment: <span class="string">'合作伙伴名称,可以是个人也可以使组织机构'</span>,</span><br><span class="line">      description: <span class="string">'合作伙伴名称,可以是个人也可以使组织机构'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    concat: &#123;</span><br><span class="line">      type: DataTypes.STRING(<span class="number">16</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span>,</span><br><span class="line">      comment: <span class="string">'联系人姓名'</span>,</span><br><span class="line">      description: <span class="string">'联系人姓名'</span></span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    cellphone: &#123;</span><br><span class="line">      type: DataTypes.STRING(<span class="number">11</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span>,</span><br><span class="line">      comment: <span class="string">'联系人手机号码'</span>,</span><br><span class="line">      description: <span class="string">'联系人手机号码'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    email: &#123;</span><br><span class="line">      type: DataTypes.STRING(<span class="number">64</span>),</span><br><span class="line">      allowNull: <span class="literal">true</span>,</span><br><span class="line">      comment: <span class="string">'联系人电子邮件地址'</span>,</span><br><span class="line">      description: <span class="string">'联系人电子邮件地址'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    status: &#123;</span><br><span class="line">      type: DataTypes.STRING(<span class="number">16</span>),</span><br><span class="line">      allowNull: <span class="literal">false</span>,</span><br><span class="line">      defaultValue: <span class="string">'PENDING'</span>, <span class="comment">// 'APPROVED, REJECTED',</span></span><br><span class="line">      comment: <span class="string">'合作伙伴状态,PENDING:等待审核,APPROVED:已经核准,REJECTED:已拒绝'</span>,</span><br><span class="line">      description: <span class="string">'合作伙伴状态,PENDING:等待审核,APPROVED:已经核准,REJECTED:已拒绝'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    comment: <span class="string">'合作伙伴信息表'</span>,</span><br><span class="line">    classMethods: &#123;</span><br><span class="line">      associate: <span class="function"><span class="keyword">function</span> (<span class="params">models</span>) </span>&#123;</span><br><span class="line">        partner.hasMany(models.map);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getterMethods: &#123;</span><br><span class="line">      created_at: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> moment(<span class="keyword">this</span>.getDataValue(<span class="string">'created_at'</span>)).format(<span class="string">'YYYY-MM-DD'</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      updated_at: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> moment(<span class="keyword">this</span>.getDataValue(<span class="string">'updated_at'</span>)).format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      deleted_at: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> moment(<span class="keyword">this</span>.getDataValue(<span class="string">'deleted_at'</span>)).format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    indexes: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'partner_unique_index_name'</span>,</span><br><span class="line">        unique: <span class="literal">true</span>,</span><br><span class="line">        method: <span class="string">'BTREE'</span>,</span><br><span class="line">        fields: [<span class="string">'name'</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'partner_unique_index_cellphone'</span>,</span><br><span class="line">        unique: <span class="literal">true</span>,</span><br><span class="line">        method: <span class="string">'BTREE'</span>,</span><br><span class="line">        fields: [<span class="string">'cellphone'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;);</span><br><span class="line">  partner._status = &#123;</span><br><span class="line">    PENDING: <span class="string">'PENDING'</span>,</span><br><span class="line">    APPROVED: <span class="string">'APPROVED'</span>,</span><br><span class="line">    REJECTED: <span class="string">'REJECTED'</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> partner;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-23T19:13:52.000Z"><a href="/2014/12/24/javascript-osm-building/">2014-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/24/javascript-osm-building/">OSM building</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>OSM Buildings 是一个OpenStreetMaps建筑几何体的可视化库.</p>
<p><img src="http://developerworks.github.io/assets/leafletjs/412EEDB9-268F-4D6A-9243-845A632F9A80.png" alt="龙湖北城天街OSM Buildings"></p>
<ul>
<li><p>从 <code>0.2.2</code> 开始如下方法名称被重命名</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadData() -&#62; load()&#10;setData() -&#62; set()&#10;setStyle() -&#62; style()&#10;setDate() -&#62; date()</span><br></pre></td></tr></table></figure>
</li>
<li><p>与Leaflet集成</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;head&#62;&#10;  &#60;link rel=&#34;stylesheet&#34; href=&#34;http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css&#34;&#62;&#10;  &#60;script src=&#34;http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js&#34;&#62;&#60;/script&#62;&#10;  &#60;script src=&#34;OSMBuildings-Leaflet.js&#34;&#62;&#60;/script&#62;&#10;&#60;/head&#62;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化地图引擎并添加地图Tile层</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#29926;&#29255;&#27169;&#26495;&#10;new L.TileLayer(&#10;&#39;http://&#123;s&#125;.tiles.mapbox.com/v3/osmbuildings.kbpalbpk/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&#39;,&#10;&#123; attribution: &#39;Map tiles &#38;copy; &#60;a href=&#34;http://mapbox.com&#34;&#62;MapBox&#60;/a&#62;&#39;, maxNativeZoom: 19, maxZoom: 21 &#125;&#10;).addTo(map);</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置GeoJSON数据</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// ==========&#10;// GeoJSON&#23618;&#10;// ==========&#10;var geojsonLayer = L.geoJson([longforGeojsonFeature], &#123;&#10;  style: function (feature) &#123;&#10;    return feature.properties &#38;&#38; feature.properties.style;&#10;  &#125;,&#10;  onEachFeature: function (feature, layer) &#123;&#10;    console.log(feature);&#10;    layer.bindPopup(feature.properties.name);&#10;  &#125;&#10;&#125;).addTo(map);</span><br></pre></td></tr></table></figure>
</li>
<li><p>集成OSM Buildings显示3D建筑物:</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// ============================&#10;// &#38598;&#25104;OSM Buildings&#26174;&#31034;3D&#24314;&#31569;&#29289;&#10;// ============================&#10;// &#21152;&#36733;&#25968;&#25454;&#10;var osmb = new OSMBuildings(map)&#10;  .date(new Date(2014, 10, 8, 8, 0))&#10;  .load()&#10;  .click(function (e) &#123;&#10;    console.log(&#39;feature clicked:&#39;, e);&#10;    osmb.getDetails(e.feature, function (json) &#123;&#10;      console.log(json.features[0].properties.tags);&#10;      var popup = L.popup()&#10;        .setLatLng([29.58170544840436, 106.53061509132385])&#10;        .setContent(&#10;            &#39;&#60;h3 style=&#34;margin: 5px 0&#34;&#62;&#39; +&#10;            json.features[0].properties.tags.name + &#39;&#60;/h3&#62;&#39; + &#39;&#60;br/&#62;&#39; +&#10;            json.features[0].properties.tags.description&#10;        )&#10;        .openOn(map);&#10;    &#125;);&#10;  &#125;);&#10;// &#21152;&#36733;&#23618;&#20999;&#25442;&#22120;&#10;L.control.layers(&#123;&#125;, &#123; Buildings: osmb &#125;).addTo(map);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="完整项目代码">完整项目代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/developerworks/leaflet-longfor.git&#10;cd leaflet-longfor&#10;bower install&#10;npm install&#10;# &#21551;&#21160;Web&#26381;&#21153;&#22120;&#10;python -m SimpleHTTPServer 8888 # Python 2.7&#10;python -m http.server 8888      # Python 3&#10;# &#27983;&#35272;&#22120;&#22320;&#22336;&#26639;&#10;http://localhost:8888/examples</span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li><p>Leafletjs API参考手册<br><a href="http://leafletjs.com/reference.html" target="_blank" rel="external">http://leafletjs.com/reference.html</a></p>
</li>
<li><p>OSM Buidling Github项目地址<br><a href="https://github.com/kekscom/osmbuildings" target="_blank" rel="external">https://github.com/kekscom/osmbuildings</a></p>
</li>
<li><p>Leaflet 集成 OSM Buildings 显示 3D 建筑物<br><a href="http://www.cuitu.net/content/leaflet-ji-cheng-osm-buildings-xian-shi-3d-jian-zhu-wu" target="_blank" rel="external">http://www.cuitu.net/content/leaflet-ji-cheng-osm-buildings-xian-shi-3d-jian-zhu-wu</a></p>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-20T14:33:00.000Z"><a href="/2014/12/20/semantic-ui-get-started/">2014-12-20</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/20/semantic-ui-get-started/">Semantic UI 入门</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p><img src="/assets/semantic-ui/logo.png" alt="Semantic UI"></p>
<h2 id="基本用法">基本用法</h2><p>在<code>&lt;head&gt;</code>内引入<code>dist/semantic.min.css</code>和<code>/dist/semantic.min.js</code>两个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/dist/semantic.min.css&#34;&#62;&#10;&#60;script src=&#34;/dist/semantic.min.js&#34;&#62;&#60;/script&#62;</span><br></pre></td></tr></table></figure>
<p>也可以使用单独的某个组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/dist/components/icon.css&#34;&#62;</span><br></pre></td></tr></table></figure>
<h2 id="推荐用法">推荐用法</h2><p><img src="/assets/semantic-ui/gulp-install.gif" alt="gulp install"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Semantic-Org/Semantic-UI.git&#10;cd Semantic-UI&#10;npm install&#10;gulp</span><br></pre></td></tr></table></figure>
<p>运行 <code>gulp</code> 进入交互式设置, 会问你一些问题, 仔细看, 仔细答.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp            // &#23433;&#35013;&#21518;&#30417;&#35270;&#20462;&#25913;&#10;gulp build      // &#20174;&#28304;&#20195;&#30721;&#26500;&#24314;&#25152;&#26377;&#25991;&#20214;&#10;gulp clean      // &#28165;&#38500;dist&#30446;&#24405;&#10;gulp watch      // &#30417;&#35270;&#25991;&#20214;&#10;gulp install    // &#37325;&#26032;&#36816;&#34892;&#23433;&#35013;&#10;gulp help       // &#21015;&#20030;&#25152;&#26377;&#21629;&#20196;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-18T11:45:31.000Z"><a href="/2014/12/18/ejabberd-stream-management-for-mobile-3g-network/">2014-12-18</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/18/ejabberd-stream-management-for-mobile-3g-network/">移动3G网络下的流管理</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>这篇文章的起因是因为朋友开发的移动社交APP使用Ejabberd的时候遇到了3G网络频繁断开连接的问题.<br>由于3G网络的特性,在3G网络内的客户端IP可能是频繁变化的,你手持移动设备在不停的移动,遇到建筑物,<br>进入电梯等都可能导致3G网络突然中断.等你再次连接上服务器的时候,之前的状态就已经丢失了.</p>
<p>为了解决这类问题, XMPP基金会发布了一个XMPP扩展协议<a href="http://demo.netfoucs.com/yuedong56/article/details/38120101" target="_blank" rel="external">XEP-198 Stream Management</a> 类支持XMPP会话的恢复.</p>
<p>Ejabberd在14.05之后内置了对流管理的支持, 所以要使服务器支持流管理, 必须升级到至少14.05, Ejabberd的默认配置是打开了流管理功能的.</p>
<p>下面是服务器需要支持的配置选项:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen:&#10;  -&#10;    port: 5222&#10;    module: ejabberd_c2s&#10;    ##&#10;    ## If TLS is compiled in and you installed a SSL&#10;    ## certificate, specify the full path to the&#10;    ## file and uncomment these lines:&#10;    ##&#10;    ## certfile: &#34;/path/to/ssl.pem&#34;&#10;    ## starttls: true&#10;    ##&#10;    ## To enforce TLS encryption for client connections,&#10;    ## use this instead of the &#34;starttls&#34; option:&#10;    ##&#10;    ## starttls_required: true&#10;    ##&#10;    ## Custom OpenSSL options&#10;    ##&#10;    ## protocol_options:&#10;    ##   - &#34;no_sslv3&#34;&#10;    ##   - &#34;no_tlsv1&#34;&#10;    max_stanza_size: 65536&#10;    shaper: c2s_shaper&#10;    access: c2s&#10;    zlib: true&#10;    ##&#10;    ## &#25171;&#24320;(true)&#25110;&#20851;&#38381;(false)Ejabberd&#30340;&#27969;&#31649;&#29702;(XEP 198)&#21151;&#33021;, &#40664;&#35748;&#20026;true&#10;    ##&#10;    stream_management: true&#10;    ##&#10;    ## &#28040;&#24687;&#30830;&#35748;&#38431;&#21015;, &#29992;&#20110;&#23384;&#20648;&#23458;&#25143;&#31471;&#26410;&#30830;&#35748;&#30340;&#28040;&#24687;&#38431;&#21015;, &#29992;&#20110;&#37325;&#20256;, &#24403;&#36229;&#36807;&#27492;&#38480;&#21046;&#26102;,&#10;    ## &#23458;&#25143;&#31471;&#20250;&#35805;&#33258;&#21160;&#34987;Ejabberd&#32456;&#27490;, &#26377;&#25928;&#20540;&#20026;&#27491;&#25972;&#25968;&#21644;`infinity`, &#40664;&#35748;&#20540;&#20026;500&#10;    ##&#10;    max_ack_queue: 500&#10;    ##&#10;    ## &#20250;&#35805;&#36229;&#26102;&#26159;&#37325;&#20256;&#10;    ##&#10;    ## &#26410;&#34987;&#23458;&#25143;&#31471;&#30830;&#35748;&#30340;&#28040;&#24687;&#23558;&#22312;&#20250;&#35805;&#36229;&#26102;&#30340;&#26102;&#20505;&#37325;&#20256;(retransimission),&#10;    ## &#35813;&#34892;&#20026;&#36890;&#24120;&#26159;&#25105;&#20204;&#25152;&#26399;&#26395;&#30340;, &#20294;&#26159;&#22312;&#26576;&#20123;&#29615;&#22659;&#19979;&#21487;&#33021;&#23548;&#33268;&#19981;&#26399;&#26395;&#30340;&#32467;&#26524;, &#27604;&#22914;:&#10;    ## &#24403;&#19968;&#20010;&#28040;&#24687;&#21516;&#26102;&#21457;&#36865;&#32473;&#20004;&#20010;&#36164;&#28304;&#26102;, &#22914;&#26524;&#19968;&#20010;&#36164;&#28304;&#36229;&#26102;, &#37027;&#20040;&#21478;&#19968;&#20010;&#36164;&#28304;&#23558;&#25910;&#21040;&#26381;&#21153;&#22120;&#37325;&#20256;&#30340;&#28040;&#24687;,&#10;    ## &#36825;&#19981;&#26159;&#25105;&#20204;&#25152;&#26399;&#26395;&#30340;&#32467;&#26524;. &#22240;&#27492;Ejabberd&#40664;&#35748;&#23545;&#27492;&#36873;&#39033;&#30340;&#35774;&#32622;&#20026;false, &#21547;&#20041;&#20026;&#24403;&#20250;&#35805;&#36229;&#26102;&#21518;,&#10;    ## &#36820;&#22238;&#19968;&#20010;&#38169;&#35823;, &#32780;&#19981;&#26159;&#37325;&#20256;&#28040;&#24687;&#10;    ##&#10;    ## &#20026;&#20102;&#36991;&#20813;&#19978;&#36848;&#20004;&#20010;&#36164;&#28304;&#20854;&#20013;&#19968;&#20010;&#36229;&#26102;&#30340;&#21103;&#20316;&#29992;,&#21487;&#20197;:&#10;    ## 1. &#22914;&#26524;&#19968;&#20010;JID &#21482;&#20801;&#35768;&#26377;&#19968;&#20010; Resource&#21516;&#26102;&#22312;&#32447;, &#37027;&#20040;&#25105;&#20204;&#21487;&#20197;&#25226;&#35813;&#36873;&#39033;&#35774;&#32622;&#20026;true&#10;    ## 2. &#22914;&#26524;&#19968;&#20010;JID &#20801;&#35768;&#19981;&#27490;&#19968;&#20010; Resource&#21516;&#26102;&#22312;&#32447;, &#24314;&#35758;&#25226;&#35813;&#36873;&#39033;&#35774;&#32622;&#20026;false&#10;    resend_on_timeout: false</span><br></pre></td></tr></table></figure>
<p>要启用XMPP扩展协议XEP 198所描述的流恢复功能, 还需要客户端主动打开流恢复功能. 客户端要判断服务器是否支持流管理特性, 在流初始化阶段服务器会返回如下信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;stream:features xmlns=&#34;jabber:client&#34;&#10;    xmlns:stream=&#34;http://etherx.jabber.org/streams&#34; version=&#34;1.0&#34;&#62;&#10;  &#60;bind xmlns=&#34;urn:ietf:params:xml:ns:xmpp-bind&#34;/&#62;&#10;  &#60;session xmlns=&#34;urn:ietf:params:xml:ns:xmpp-session&#34;/&#62;&#10;  &#60;sm xmlns=&#34;urn:xmpp:sm:2&#34;/&#62;&#10;  &#60;sm xmlns=&#34;urn:xmpp:sm:3&#34;/&#62;&#10;  &#60;csi xmlns=&#34;urn:xmpp:csi:0&#34;/&#62;&#10;  &#60;c xmlns=&#34;http://jabber.org/protocol/caps&#34;&#10;    hash=&#34;sha-1&#34;&#10;    node=&#34;http://www.process-one.net/en/ejabberd/&#34;&#10;    ver=&#34;aIT+/ulfcbHXDKPkCA+iw9x5mU8=&#34;/&#62;&#10;  &#60;register xmlns=&#34;http://jabber.org/features/iq-register&#34;/&#62;&#10;&#60;/stream:features&#62;</span><br></pre></td></tr></table></figure>
<p>如果包含:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...&#10;&#60;sm xmlns=&#34;urn:xmpp:sm:2&#34;/&#62;&#10;&#60;sm xmlns=&#34;urn:xmpp:sm:3&#34;/&#62;&#10;...</span><br></pre></td></tr></table></figure>
<p>那么说明服务器是支持流管理特性的. 这个时候我们可以让客户端发送一个<code>&lt;enable&gt;</code>XML片段通知服务器端打开流管理.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;enable xmlns=&#39;urn:xmpp:sm:3&#39; resume=&#39;true&#39;/&#62;</span><br></pre></td></tr></table></figure>
<p>同时服务响应一个<code>&lt;enabled&gt;</code>标签,表示服务器的流管理已经打开.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;enabled xmlns=&#34;urn:xmpp:sm:3&#34;&#10;    id=&#34;g2gCbQAAABk5NDIyMTUxMzkxNDE4OTA0NzEwMjA1OTUxaANiAAAFimIADc4EYgAO508=&#34;&#10;    resume=&#34;true&#34;&#10;    max=&#34;300&#34;&#10;    xmlns:stream=&#34;http://etherx.jabber.org/streams&#34;&#10;    version=&#34;1.0&#34;/&#62;</span><br></pre></td></tr></table></figure>
<p><code>&lt;enabled&gt;</code>标签上有几个重要的属性:</p>
<ul>
<li><code>id</code> 流管理的会话ID</li>
<li><code>resume</code> 是否支持流恢复</li>
<li><code>max</code> 会话超时时间</li>
</ul>
<p>上述的流管理会话的建立过程必须是在通过了身份认证之和资源绑定之后, 如果未<code>通过身份认证</code>和<code>资源绑定</code>尝试建立一个流管理会话将会得到一个<code>&lt;fail/&gt;</code>.</p>
<h2 id="流的恢复">流的恢复</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;resume&#10;    xmlns=&#39;urn:xmpp:sm:3&#39;&#10;    h=&#39;some-sequence-number&#39;&#10;    previd=&#39;g2gCbQAAABk5NDIyMTUxMzkxNDE4OTA0NzEwMjA1OTUxaANiAAAFimIADc4EYgAO508=&#39;/&#62;</span><br></pre></td></tr></table></figure>
<ul>
<li><resume>必须带上<code>xmlns=&#39;urn:xmpp:sm:3&#39;</code>属性</resume></li>
<li><code>h</code> 表示断开连接之前最后一次从服务器收到的XML节的序列号</li>
<li><code>previd</code> 上一次流会话的ID</li>
</ul>
<p>客户端发送流恢复请求之后, 服务端会重新生成一个<code>id</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;enabled&#10;    xmlns=&#34;urn:xmpp:sm:3&#34;&#10;    id=&#34;g2gCbQAAABozNDY3MjMxMTkyMTQxODkwNjE4MDM1NjIwM2gDYgAABYpiAA3Tw2IAAlr+&#34;&#10;    resume=&#34;true&#34;&#10;    max=&#34;300&#34;&#10;    xmlns:stream=&#34;http://etherx.jabber.org/streams&#34; version=&#34;1.0&#34;/&#62;</span><br></pre></td></tr></table></figure>
<p>我们看到服务器响应了一个<code>&lt;enabled&gt;</code>标签, 其属性<code>id</code>的值和之前是不同的.</p>
<p>客户端需要记录这个值, 以备下一次连接中断后的流恢复.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-18T07:47:48.000Z"><a href="/2014/12/18/elixir-understanding-macro-part-3/">2014-12-18</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/18/elixir-understanding-macro-part-3/">(译)理解Elixir宏第3部分</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>继续我们对宏的探索. 上一篇我概括了一些基本原理, 今天我们来讨论关于Elixir AST的一些细节.</p>
<h2 id="追踪函数调用">追踪函数调用</h2><h2 id="发现AST结构">发现AST结构</h2><h2 id="编写断言宏">编写断言宏</h2><h2 id="序列化代码">序列化代码</h2>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-18T07:45:38.000Z"><a href="/2014/12/18/elixir-understanding-macro-part-2/">2014-12-18</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/18/elixir-understanding-macro-part-2/">(译)理解Elixir宏第2部分</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>这是理解Elixir宏系列文章的第二篇. <a href="/2014/12/18/elixir-understanding-macro-part-1/">上一篇</a>讨论了<code>编译阶段</code>和<code>Elixir宏</code></p>
<h2 id="调用宏">调用宏</h2><p>要知道在编译过程的展开阶段最重要的事情是: 编译器调用各种宏(以及其他代码生成构造), 并产生最终的AST.</p>
<p>例如, 一个经典的对<code>trace</code>宏的使用示例如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#23450;&#20041;&#20102;&#25105;&#20204;&#30340;&#24212;&#29992;&#27169;&#22359;&#10;defmodule MyModule do&#10;  # &#21253;&#21547;&#20102;&#25105;&#20204;&#38656;&#35201;&#29992;&#21040;&#30340;&#20195;&#30721;&#35843;&#35797;&#21644;&#36861;&#36394;&#27169;&#22359;&#10;  require Tracer&#10;  ...&#10;  def some_fun(...) do&#10;    # &#35843;&#29992;&#20855;&#20307;&#30340;&#36861;&#36394;&#27169;&#22359;&#35843;&#35797;&#20195;&#30721;&#10;    Tracer.trace(...)&#10;  end&#10;end</span><br></pre></td></tr></table></figure>
<h2 id="Hygiene">Hygiene</h2><p>上一章提到过, 宏默认是<code>hygienic</code>的. 其含义是: 宏引入的变量有其自己的私有作用域, 不会影响代码的其他部分. 这就是为什么我们能安全地在<code>trace</code>宏中引入<code>result</code>变量.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quote do&#10;    result = unquote(expression_ast) # result &#21464;&#37327;&#26159;&#23439;&#30340;&#31169;&#26377;&#21464;&#37327;&#10;    ...&#10;end</span><br></pre></td></tr></table></figure>
<p>该变量不会干扰调用这个宏的代码. 在调用宏的地方, 可以随意的声明你自己的<code>result</code>变量, 它不会被<code>tracer</code>宏中的<code>result</code>变量隐藏.</p>
<p>大多数时候<code>hygiene</code>是我们想要的效果, 但是也有例外. 有时候, 可能需要创建在调用者作用域内可用的变量. 下面我们通过Plug库的一个用例来演示, 我们如何使用Plug来制定路由:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get &#34;/resource1&#34; do&#10;    send_resp(conn, 200, ...)&#10;end&#10;post &#34;/resource2&#34; do&#10;    send_resp(conn, 200, ...)&#10;end</span><br></pre></td></tr></table></figure>
<p>注意,上面这两个宏如何使用并不存在的<code>conn</code>变量. 这是因为, <code>get</code>宏在生成的代码中绑定了该变量. 可以想象一下, 产生的代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defp do_match(&#34;GET&#34;, &#34;/resource1&#34;, conn) do&#10;    ...&#10;end&#10;defp do_match(&#34;POST&#34;, &#34;/resource2&#34;, conn) do&#10;    ...&#10;end</span><br></pre></td></tr></table></figure>
<p>注意: Plug产生的真实代码是不同的, 这里为了演示对其进行了简化.</p>
<p>这是一个例子, 宏引入了一个变量, 必须不是<code>hygienic</code>. 变量<code>conn</code>由<code>get</code>宏引入, 必须对调用者可见.</p>
<h2 id="宏参数">宏参数</h2><h2 id="揉到一起">揉到一起</h2><h2 id="使用模块">使用模块</h2><p>查看上面的代码, 函数<code>match/2</code>是在客户端模块中实现. 这确实是太不完美了, 因为每个客户端模块都必须提供该函数的正确实现,并知道<code>do_match</code>函数如何调用.</p>
<p>如果<code>Plug.Router</code>能够提供<code>match/2</code>的实现是不是更好. 对此我们可以采用<code>use</code>宏, 它初略地等同于其他语言中的Mixin.</p>
<p>普遍的思想是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#23458;&#25143;&#31471;&#27169;&#22359;&#37096;&#20998;&#10;defmodule ClientCode do&#10;  # invokes the mixin&#10;  use GenericCode, option_1: value_1, option_2: value_2, ...&#10;end&#10;# &#36890;&#29992;&#20195;&#30721;&#37096;&#20998;&#10;defmodule GenericCode do&#10;  # called when the module is used&#10;  defmacro __using__(options) do&#10;    # generates an AST that will be inserted in place of the use&#10;    quote do&#10;      ...&#10;    end&#10;  end&#10;end</span><br></pre></td></tr></table></figure>
<p><code>use</code>机制允许我们在调用者的上下文种注入代码, 这类似于如下这种替代形式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defmodule ClientCode do&#10;    # &#21152;&#36733;&#36890;&#29992;&#27169;&#22359;&#10;    require GenericCode&#10;    # &#35843;&#29992;&#36890;&#29992;&#27169;&#22359;&#20013;&#30340;&#20844;&#20849;&#20989;&#25968;&#10;    GenericCode.__using__(...)&#10;end</span><br></pre></td></tr></table></figure>
<p>其可以通过<code>use</code>宏的<a href="https://github.com/elixir-lang/elixir/blob/v0.14.0/lib/elixir/lib/kernel.ex#L3531-L3532" target="_blank" rel="external">Elixir实现源代码</a>得到证明. 同时还证明了另一点 - 增量展开.</p>
<p><code>use</code>宏生成了调用其他宏的代码. 说的更明白一点, <code>use</code>生成了用于生成代码的代码(use生成了代码,生成的代码又用于生成其他的代码), 早前我们曾说过, 编译器会递归地展开它所发现的所有宏定义, 直到没有可展开的宏为止.</p>
<p>拥有了这方面的知识, 现在可以转移到<code>Plug.Router</code>通用模块的<code>match</code>函数的实现.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defmodule Plug.Router do&#10;  defmacro __using__(_options) do&#10;    # &#35793;&#27880;:&#10;    # &#22312;&#35843;&#29992;&#32773;use&#26412;&#27169;&#22359;&#30340;&#26102;&#20505;&#36820;&#22238;&#19968;&#20010;AST&#32467;&#26500;,&#24182;&#25554;&#20837;&#21040;use&#34987;&#20351;&#29992;&#30340;&#20301;&#32622;&#10;    # &#22914;&#26524;&#20320;&#26377;Web&#30340;&#24320;&#21457;&#32463;&#39564;, &#31867;&#20284;&#20110;&#22312;DOM&#26641;&#20013;&#25554;&#20837;&#19968;&#20010;&#23376;&#26641;&#25110;&#23376;&#33410;&#28857;,&#29992;&#20110;&#25913;&#21464;&#25972;&#20010;DOM&#26641;&#30340;&#32467;&#26500;,&#10;    # &#31867;&#20284;&#30340;__using__&#23439;&#36820;&#22238;&#19968;&#20010;AST&#29255;&#27573;, &#24182;&#25554;&#20837;&#21040;&#35843;&#29992;&#20195;&#30721;&#30340;&#20301;&#32622;, &#20063;&#23601;&#26159;&#22312;&#23458;&#25143;&#31471;&#27169;&#22359;&#20013;`use`&#23439;&#20351;&#29992;&#30340;&#20301;&#32622;&#10;    quote do&#10;      # &#23548;&#20837;&#33258;&#36523;, &#20197;&#20415;&#22312;&#23458;&#25143;&#31471;&#20195;&#30721;&#20013;&#19981;&#24517;&#20197;`Plug.Router.get`&#30340;&#24418;&#24335;&#20351;&#29992;,&#32780;&#26159;&#30452;&#25509;&#20351;&#29992;`get`&#10;      import Plug.Router&#10;      def match(type, route) do&#10;        do_match(type, route, :dummy_connection)&#10;      end&#10;    end&#10;  end&#10;  defmacro get(route, body) do&#10;    ... # &#36825;&#37324;&#30340;&#20195;&#30721;&#20445;&#25345;&#21407;&#26679;&#10;  end&#10;end</span><br></pre></td></tr></table></figure>
<p>这样, 我们就可以把客户端模块的代码保持的非常苗条:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defmodule MyRouter do&#10;  # &#20351;&#29992;Plug.Router&#27169;&#22359;,&#21516;&#26102;&#22312;&#32534;&#35793;&#38454;&#27573;(&#20855;&#20307;&#23454;&#38469;&#19978;&#26159;&#23637;&#24320;&#38454;&#27573;),&#36816;&#34892;&#35813;&#27169;&#22359;&#20013;&#30340;`__using__`&#23439;,&#10;  # &#24182;&#25226;`__using__`&#36820;&#22238;&#30340;AST&#29255;&#27573;&#25554;&#20837;&#21040;&#24403;&#21069;&#20301;&#32622;&#10;  use Plug.Router&#10;  get &#34;/hello&#34;, do: &#123;conn, &#34;Hi!&#34;&#125;&#10;  get &#34;/goodbye&#34;, do: &#123;conn, &#34;Bye!&#34;&#125;&#10;end</span><br></pre></td></tr></table></figure>
<p>前面曾提到, 由<code>__using__</code>宏生成的AST片段只是简单地插入到<code>use Plug.Router</code>调用的位置. 特别注意的是, 在<code>__use___</code>宏定义中的<code>import Plug.Router</code>, 严格意义上并不需要这行代码, 它只是使客户端代码变得更加简洁一些, 你可以使用<code>get</code>, 而不必输入其全称<code>Plug.Router.get</code>.</p>
<p>下面这段就不译了, 一堆废话, 看得懂的看, 看不懂的可以忽略.</p>
<p>So what have we gained? The various boilerplate is now confined to the single place (<code>Plug.Router</code>).<br>Not only does this simplify the client code, it also keeps the abstraction properly closed.<br>The module <code>Plug.Router</code> ensures that whatever is generated by get macros fits properly with the generic code of <code>match</code>.<br>As clients, we simply use the module and call into the provided macros to assemble our router.</p>
<p>This concludes today’s session. Many details are not covered,<br>but hopefully you have a better understanding of how macros integrate with the Elixir compiler.<br>In the next part I’ll dive deeper and start exploring how we can tear apart the input AST.</p>
<h2 id="译注">译注</h2><p>对于<code>use</code>的使用我们可以理解为:</p>
<ul>
<li>PHP中的<code>require &#39;database.php&#39;</code>和<code>include &#39;database.php&#39;</code></li>
<li>Java中的<code>import com.mysql.jdbc.Driver;</code></li>
<li>Python中的<code>import amqp</code></li>
<li>C中的<code>include &lt;stdlib.h&gt;</code></li>
</ul>
<p>它是在编译过程中的展开阶段对代码(AST)进行修改和装饰, 并把修改过的代码(AST)插入到使用的位置.</p>
<h2 id="原文">原文</h2><p><a href="http://www.theerlangelist.com/2014/06/understanding-elixir-macros-part-2.html" target="_blank" rel="external">http://www.theerlangelist.com/2014/06/understanding-elixir-macros-part-2.html</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-17T16:02:39.000Z"><a href="/2014/12/18/elixir-understanding-macro-part-1/">2014-12-18</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/18/elixir-understanding-macro-part-1/">(译)理解Elixir宏第1部分</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>本文中的某些概念, 你最好事先了解过编译原理, 以及抽象语法树的(AST)概念, 否则本文中所描述的东西可能对你来说是看不懂的天书.</p>
<h2 id="编译过程">编译过程</h2><p><img src="/assets/elixir/compile-process.png" alt="Elixir源码编译过程图示"></p>
<p>通过上图的Elixir编译器的编译过程我们看到:</p>
<ol>
<li>Elixir源码通过第一步解析过程生成了一个AST 1的中间形式(以Elixir嵌套Term的形式来表示抽象语法树)</li>
<li>AST 1通过(展开<code>expansion</code>)转换为Expanded AST(已展开的抽象语法树)</li>
<li>展开的AST被转换成字节码</li>
</ol>
<p>这只是一个近似的过程, 实际上Elixir编译器会生成Erlang AST, 并依赖于底层的Erlang函数把它转换成字节码.</p>
<h2 id="创建AST片段">创建AST片段</h2><p>什么是Elixir AST ? 它是一个Elixir Term, 一个深度嵌套的层次结构, 用于表述一个语法正确的Elixir代码. 为了说得更明白一些, 举个例子. 要生成某段代码的AST, 可以使用<code>quote</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(1)&#62; quoted = quote do 1 + 2 dn&#10;&#123;:+, [context: Elixir, import: Kernel], [1, 2]&#125;</span><br></pre></td></tr></table></figure>
<p>Quote 以任意复杂的Elixir表达式作为输入,并返回相应的描述该输入代码的AST.</p>
<p>此例中, 生成的AST片段描述一个简单的求和操作(1+2). 通常称为<code>quoted expression</code>. 大多数时候不需要理解quoted结构的具体细节, 来看一个简单的例子. 在这种情况下, AST片段是一个包含如下元素的三元组(triplet)</p>
<ul>
<li>一个操作符原子</li>
<li>表达式上下文(比如, import和aliases).大多数时候不需要理解该数据</li>
<li>操作参数(operands)</li>
</ul>
<p>要点: <code>quoted expression</code>是一个描述代码的Elixir term. 编译器会使用它生成最终的字节码.</p>
<p>虽然不常见, 对一个quoted expression求值也是可以的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(2)&#62; Code.eval_quoted(quoted)&#10;&#123;3, []&#125;</span><br></pre></td></tr></table></figure>
<p>求值结果为一个元组, 包含表达式的求值结果, 以及构成该表达式的变量.</p>
<p>但是, 在AST被求值前(通常由编译器完成), quoted expression 并没有通过语义上的验证. 例如, 当我们书写如下表达式时:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(3)&#62; a + b&#10;** (RuntimeError) undefined function: a/0</span><br></pre></td></tr></table></figure>
<p>得到了一个错误, 因为这里还不存在一个名为<code>a</code>的变量或函数.</p>
<p>相比而言, 如果quote一个表达式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(4)&#62; quote do a + b end&#10;&#123;:+, [context: Elixir, import: Kernel], [&#123;:a, [], Elixir&#125;, &#123;:b, [], Elixir&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>而没有发生错误, 我们有了一个表达式 <code>a+b</code>的quoted表示. 其意思是, 生成了一个描述表达式<code>a+b</code>的term, 不管表达式中的变量是否存在. 最终的代码并没有生成, 所以这里不会有错误.</p>
<p>如果把该表述插入到某些a和b是有效标识符的AST中, 刚才发生错误的代码<code>a+b</code>,才是正确的. 下面来试一下, 首先quote一个求和(sum)表达式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(5)&#62; sum_expr = quote do a + b end</span><br></pre></td></tr></table></figure>
<p>然后创建一个quoted变量绑定表达式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(6) bind_expr = quote do&#10;         a = 1&#10;         b = 2&#10;       end</span><br></pre></td></tr></table></figure>
<p>再说一遍, 记住这仅仅是quoted的表达式, 他们只是描述代码的简单数据, 并没有执行任何求值. 特别是, 变量 <code>a</code> 和 <code>b</code> 在当前的Elixir shell会话中并不存在.</p>
<p>要使这些片段能够一起工作, 必须把它们连接起来:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(7) final_expr = quote do&#10;         unquote(bind_expr)&#10;         unquote(sum_expr)&#10;       end</span><br></pre></td></tr></table></figure>
<p>这里,我们生成了一个新的quoted表达式<code>final_expr</code>, 由<code>bind_expr</code>表达式和<code>sum_expr</code>表达式构成.</p>
<p>下面可以对最终的AST求值:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(8)&#62; Code.eval_quoted(final_expr)&#10;&#123;3, [&#123;&#123;:a, Elixir&#125;, 1&#125;, &#123;&#123;:b, Elixir&#125;, 2&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>求值结果由一个<code>表达式</code>, 一个<code>变量绑定列表</code>构成. 形如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;expression, [&#123;&#123;:variable,Elixir&#125;, value&#125;,...]&#125;&#10;===========      ========          ======&#10;  |                 |                 |&#10;&#34920;&#36798;&#24335;            &#21464;&#37327;&#21517;&#31216;           &#21464;&#37327;&#30340;&#20540;</span><br></pre></td></tr></table></figure>
<p>从这个绑定列表中我们可以看出, 该表达式绑定了两个变量<code>a</code>和<code>b</code>, 对应的值分别为<code>1</code>和<code>2</code></p>
<p>这就是在Elixir中元编程方法的核心. 当我们进行元编程的时候, 我们基本上是把各种AST片段组合起来生成新的AST. 我们通常对输入AST的内容和结构不感兴趣, 相反, 我们使用<code>quote</code>生成和组合输入片段,并生成经过修饰的代码.</p>
<h2 id="Unquoting">Unquoting</h2><p><code>unquote</code>上场了. 注意不管<code>quote</code>块里面包含什么, 它只是把<code>quote ... end</code>块里面的达式转换成AST片段. 这意味着我们不能以常规方式注入存在于quote外部的变量的内容. 看看上面这个例子, 它是不可能工作的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quote do&#10;  bind_expr&#10;  sum_expr&#10;end</span><br></pre></td></tr></table></figure>
<p>在这个例子中, quote仅仅是简单的生成对<code>bind_expr</code>和<code>sum_expr</code>的变量引用, 但这不是我想要的结果. 我需要的效果是有一种方式能够直接注入<code>bind_expr</code>和<code>sum_expr</code>的内容到生成的AST的对应的位置.</p>
<p>这就是<code>unquote(...)</code>的用途 - 括号内的表达式被立即进行求值, 并就地插入到<code>unquote</code>调用的位置. 这意味着 <code>unquote</code> 的结果也必须是一个有效的AST片段.</p>
<p>理解<code>unquote</code>的另一种方式是, 可以把它看做是字符串插值 (<code>#{}</code>). 对于字符串你可以这样写:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#34;....#&#123;some_expression&#125;....&#34;</span><br></pre></td></tr></table></figure>
<p>类似的, 对于quote可以这样写:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quote do&#10;    ...&#10;    unquote(some_expression)&#10;    ...&#10;end</span><br></pre></td></tr></table></figure>
<p>对此两种情况, 求值的表达式必须在当前上下文中是有效的, 并注入该结果到你构建的表达式中.(要么是符串, 或者是一个AST片段)</p>
<p>重要的时理解其含义, unquote并不是quote的反向过程. 如果需要把一个quoted expression转换为字符串, 可以使用<code>Macro.to_string/1</code></p>
<h2 id="例子:_追踪表达式">例子: 追踪表达式</h2><p>让我们把这些理论组合到一个简单的例子中. 我们会编写一个宏来帮助我们调试代码. 下面是这个宏的使用方式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(1)&#62; Tracer.trace(1 + 2)&#10;Result of 1 + 2: 3</span><br></pre></td></tr></table></figure>
<p><code>Tracer.trace</code>以一个给定的表达式并打印其结果到屏幕上. 然后返回表达式结果.</p>
<p>重要的是,意识到这是一个宏, 其输入表达式<code>(1 + 2)</code>会被转换为一个更加复杂的形式 - 一段打印结果并返回该结果的代码.该转换发生在宏展开的时候, 产生的字节码为输入代码经过修饰的版本.</p>
<p>在查看实现之前, 想象一下最终结果. 当我们调用<code>Tracer.trace(1+2)</code>时, 对应产生的字节码类似于这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mangled_result = 1 + 2&#10;Tracer.print(&#34;1+2&#34;, mangled_result)&#10;mangled_result</span><br></pre></td></tr></table></figure>
<h2 id="展开AST">展开AST</h2><p>在Shell观察其是如何连接起来是很容易的. 启动<code>iex</code> Shell, 复制粘贴上面定义的<code>Tracer</code>模块:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(1)&#62; defmodule Tracer do&#10;          ...&#10;        end</span><br></pre></td></tr></table></figure>
<p>然后, 必须<code>require Tracer</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(2)&#62; require Tracer</span><br></pre></td></tr></table></figure>
<p>接下来, 对<code>trace</code>的宏调用进行quote操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(3)&#62; quoted = quote do Tracer.trace(1+2) end&#10;&#123;&#123;:., [], [&#123;:__aliases__, [alias: false], [:Tracer]&#125;, :trace]&#125;, [],&#10; [&#123;:+, [context: Elixir, import: Kernel], [1, 2]&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>现在, 输出看起来有点可怕, 通常你不必需要理解它. 但是如果你仔细看, 在这个结构中你可以看到<code>Tracer</code>和<code>trace</code>, 这证明了AST片段是何源代码相对应的, 但还未展开.</p>
<h2 id="参考资料">参考资料</h2><h2 id="概念补充">概念补充</h2><ul>
<li><p>Hygiene</p>
<p>  用不冲突的名称替换引入的变量名，这种方法称为健康的(<code>hygiene</code>);产生的宏称为健康的宏(<code>hygienic macros</code>).健康的宏可以安全地在任何地方使用，不必担心与现有的变量名冲突。对于许多元编程任务，这个特性使宏更可预测并容易使用。</p>
<p>  Hygiene 宏的引入是为了解决<code>宏定义上下文</code>和<code>宏调用上下文</code>变量名称冲突的问题.</p>
</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-15T08:51:37.000Z"><a href="/2014/12/15/nodejs-npm-disable-spinner-and-show-http-log/">2014-12-15</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/15/nodejs-npm-disable-spinner-and-show-http-log/">在新版本的npm恢复老版本的下载状态风格</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>新版本的npm在安装或更新包的时候, 显示的一个spinner一直在旋转, 特别是在网络速度不好的情况下体验感非常差.</p>
<p>老版本的npm安装包的时候显示的过程是这样的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm http GET https://registry.npmjs.org/repeating/-/repeating-1.1.0.tgz&#10;npm http 304 https://registry.npmjs.org/graceful-fs</span><br></pre></td></tr></table></figure>
<p>新版本显示的却是这样的:</p>
<p><img src="/assets/images/a5ff54aa-e577-11e3-8baa-43e1a81fba84.gif" alt="NPM新版本进度指示器"></p>
<p>恢复到老版本的进度显示风格可以使用下面的命令完成:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set spin=false&#10;npm config set loglevel=http</span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="https://github.com/npm/npm/issues/5340" target="_blank" rel="external">https://github.com/npm/npm/issues/5340</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-13T19:32:08.000Z"><a href="/2014/12/14/songs-wangfei-fleet-of-time/">2014-12-14</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/14/songs-wangfei-fleet-of-time/">Fleet of time &lt;&lt;匆匆那年&gt; 王菲</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>&lt;&lt;匆匆那年&gt;&gt; 王菲</p>
<pre><code>匆匆那年我们究竟说了几遍 再见之后再拖延
可惜谁有没有爱过不是一场 七情上面的雄辩

匆匆那年我们一时匆忙撂下难以承受的诺言
只有等别人兑现

不 怪那 吻痕 还 没积累成茧
拥 抱着冬眠 也 没能羽化再成仙

不 怪这一段情 没空反复再排练
是 岁月宽容恩赐 反悔的时间...

[<span class="name">REPEAT</span> <span class="number">1</span>] 如果再见不能红着眼 是否还能红着脸
[<span class="name">REPEAT</span> <span class="number">1</span>] 就像那年 匆促刻下 永远一起 那样美丽的谣言
[<span class="name">REPEAT</span> <span class="number">1</span>] 如果过去还值得眷恋 别太快冰释前嫌
[<span class="name">REPEAT</span> <span class="number">1</span>] 谁 甘心 就这样 彼此无挂也无牵

我 们要互相 亏欠 要 不然 凭何怀缅

....

匆匆那年我们见过太少世面 只爱看同一张脸
那么莫名其妙 那么讨人欢喜 闹起来又太讨厌

相爱那年活该 匆匆因为我们不懂顽固的诺言
只 是分手的前言

不 怪哪天太冷 泪 滴水成冰
春 风也一样没 吹进凝固的照片

不 怪每一个人 没能完整爱一遍
是 岁月善意落下 残缺的悬念

[<span class="name">REPEAT</span> <span class="number">2</span>] 如果再见不能红着眼 是否还能红着脸
[<span class="name">REPEAT</span> <span class="number">2</span>] 就像那年 匆促刻下 永远一起 那样美丽的谣言
[<span class="name">REPEAT</span> <span class="number">2</span>] 如果过去还值得眷恋 别太快冰释前嫌
[<span class="name">REPEAT</span> <span class="number">2</span>] 谁 甘心 就这样 彼此无挂也无牵

[<span class="name">REPEAT</span> <span class="number">3</span>] 如果再见不能红着眼 是否还能红着脸
[<span class="name">REPEAT</span> <span class="number">3</span>] 就像那年 匆促刻下 永远一起 那样美丽的谣言
[<span class="name">REPEAT</span> <span class="number">3</span>] 如果过去还值得眷恋 别太快冰释前嫌
[<span class="name">REPEAT</span> <span class="number">3</span>] 谁 甘心 就这样 彼此无挂也无牵

我们要互相亏欠 我们要藕断丝连
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-13T14:29:53.000Z"><a href="/2014/12/13/elixir-httpclient-httpotion/">2014-12-13</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/13/elixir-httpclient-httpotion/">HTTP客户端Httpotion</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="步骤">步骤</h2><p>本文描述如何使用Elixir的httpotion模块调用豆瓣图书API获取图书信息.</p>
<pre><code>root<span class="variable">@7bf32c349b69</span><span class="symbol">:~</span><span class="comment"># mix new douban_book_api_v2</span>
* creating <span class="constant">README</span>.md
* creating .gitignore
* creating mix.exs
* creating config
* creating config/config.exs
* creating <span class="class"><span class="keyword">lib</span></span>
* creating <span class="class"><span class="keyword">lib</span>/<span class="title">douban_book_api_v2</span>.<span class="title">ex</span></span>
* creating test
* creating test/test_helper.exs
* creating test/douban_book_api_v2_test.exs

<span class="constant">Your</span> mix project was created successfully.
<span class="constant">You</span> can use mix to compile it, test it, and <span class="symbol">more:</span>

    cd douban_book_api_v2
    mix test

<span class="constant">Run</span> <span class="string">`mix help`</span> <span class="keyword">for</span> more commands.
</code></pre><p>进入刚刚创建的目录<code>douban_book_api_v2</code>,编辑<code>mix.exs</code>,增加依赖模块:</p>
<p>修改函数<code>deps</code>为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defp deps do&#10;    [&#10;        &#123;:ibrowse, github: &#34;cmullaparthi/ibrowse&#34;, tag: &#34;v4.1.0&#34;&#125;,&#10;        &#123;:jiffy, github: &#34;davisp/jiffy&#34;&#125;,&#10;        &#123;:httpotion, &#34;~&#62; 0.2.0&#34;&#125;&#10;    ]&#10;end</span><br></pre></td></tr></table></figure>
<p>然后执行如下命令,下载依赖模块:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cd douban_book_api_v2&#10;# mix deps.get</span><br></pre></td></tr></table></figure>
<p>注意很多依赖模块托管在Amazon S3上,可能被墙, 可使用如下命令穿墙:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HTTP_PROXY=http://192.168.8.188:8580&#10;export HTTPS_PROXY=https://192.168.8.188:8580</span><br></pre></td></tr></table></figure>
<p>然后编译:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mix compile</span><br></pre></td></tr></table></figure>
<p>接着进入<code>iex</code>(Elixir交互式SHELL):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># iex -S mix</span><br></pre></td></tr></table></figure>
<p><img src="/assets/images/F228B9AD-80CE-4875-AFCB-49BF5446A67D.png" alt="获取图书信息"></p>
<h2 id="示例代码">示例代码</h2><p><a href="https://github.com/developerworks/douban_book_api_v2" target="_blank" rel="external">https://github.com/developerworks/douban_book_api_v2</a></p>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="https://github.com/myfreeweb/httpotion" target="_blank" rel="external">https://github.com/myfreeweb/httpotion</a></li>
<li><a href="http://developers.douban.com/wiki/?title=book_v2#get_book" target="_blank" rel="external">http://developers.douban.com/wiki/?title=book_v2#get_book</a></li>
<li><a href="https://api.douban.com/v2/book/1041007" target="_blank" rel="external">https://api.douban.com/v2/book/1041007</a></li>
<li><a href="http://learnxinyminutes.com/docs/zh-cn/elixir-cn/" target="_blank" rel="external">http://learnxinyminutes.com/docs/zh-cn/elixir-cn/</a></li>
</ol>
<h2 id="修订记录">修订记录</h2><ul>
<li>2014-12-14 13:30<br>使用<a href="https://github.com/seth/ej" target="_blank" rel="external">ej</a>模块获取由<a href="https://github.com/davisp/jiffy" target="_blank" rel="external">jiffy</a>, <a href="https://github.com/mochi/mochiweb" target="_blank" rel="external">mochijson2</a>, 或 <a href="https://github.com/benoitc/ejson" target="_blank" rel="external">ejson</a> 返回的Erlang terms</li>
</ul>
<p><img src="/assets/images/C2B21544-3DDE-48FF-A83E-229C5463790A.png" alt="Javascript的访问方法和ej的访问方法对比"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#25226;&#21709;&#24212;&#20307;&#35299;&#30721;&#20026;Erlang term&#10;json = :jiffy.decode response.body&#10;# &#36890;&#36807;ej&#27169;&#22359;&#35775;&#38382;Erlang term&#10;:ej.get(&#123;&#34;author&#34;&#125;, josn)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(21)&#62; :ej.get &#123;&#34;images&#34;, &#34;small&#34;&#125;, json&#10;&#34;http://img3.douban.com/spic/s1990480.jpg&#34;&#10;iex(22)&#62; :ej.get &#123;&#34;images&#34;, &#34;large&#34;&#125;, json&#10;&#34;http://img3.douban.com/lpic/s1990480.jpg&#34;&#10;iex(23)&#62; :ej.get &#123;&#34;images&#34;, &#34;medium&#34;&#125;, json&#10;&#34;http://img3.douban.com/mpic/s1990480.jpg&#34;&#10;iex(24)&#62; :ej.get &#123;&#34;images&#34;, &#34;medium&#34;&#125;, json&#10;&#34;http://img3.douban.com/mpic/s1990480.jpg&#34;&#10;iex(25)&#62; :ej.get &#123;&#34;images&#34;, &#34;tags&#34;, 1&#125;, json&#10;:undefined&#10;iex(26)&#62; :ej.get &#123;&#34;images&#34;, &#34;tags&#34;&#125;, json&#10;:undefined&#10;iex(27)&#62; :ej.get &#123;&#34;tags&#34;&#125;, json&#10;[&#123;[&#123;&#34;count&#34;, 13368&#125;, &#123;&#34;name&#34;, &#34;&#21704;&#21033;&#27874;&#29305;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#21704;&#21033;&#27874;&#29305;&#34;&#125;]&#125;,&#10; &#123;[&#123;&#34;count&#34;, 10741&#125;, &#123;&#34;name&#34;, &#34;J.K.&#32599;&#29747;&#34;&#125;, &#123;&#34;title&#34;, &#34;J.K.&#32599;&#29747;&#34;&#125;]&#125;,&#10; &#123;[&#123;&#34;count&#34;, 8892&#125;, &#123;&#34;name&#34;, &#34;&#39764;&#24187;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#39764;&#24187;&#34;&#125;]&#125;,&#10; &#123;[&#123;&#34;count&#34;, 7741&#125;, &#123;&#34;name&#34;, &#34;&#23567;&#35828;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#23567;&#35828;&#34;&#125;]&#125;,&#10; &#123;[&#123;&#34;count&#34;, 6536&#125;, &#123;&#34;name&#34;, &#34;&#33521;&#22269;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#33521;&#22269;&#34;&#125;]&#125;,&#10; &#123;[&#123;&#34;count&#34;, 4591&#125;, &#123;&#34;name&#34;, &#34;&#22806;&#22269;&#25991;&#23398;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#22806;&#22269;&#25991;&#23398;&#34;&#125;]&#125;,&#10; &#123;[&#123;&#34;count&#34;, 3871&#125;, &#123;&#34;name&#34;, &#34;&#21704;&#21033;&#183;&#27874;&#29305;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#21704;&#21033;&#183;&#27874;&#29305;&#34;&#125;]&#125;,&#10; &#123;[&#123;&#34;count&#34;, 3871&#125;, &#123;&#34;name&#34;, &#34;&#21704;&#21033;&#12539;&#27874;&#29305;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#21704;&#21033;&#12539;&#27874;&#29305;&#34;&#125;]&#125;]&#10;iex(28)&#62; :ej.get &#123;&#34;tags&#34;, 1&#125;, json&#10;&#123;[&#123;&#34;count&#34;, 13368&#125;, &#123;&#34;name&#34;, &#34;&#21704;&#21033;&#27874;&#29305;&#34;&#125;, &#123;&#34;title&#34;, &#34;&#21704;&#21033;&#27874;&#29305;&#34;&#125;]&#125;&#10;iex(29)&#62; :ej.get &#123;&#34;tags&#34;, 1, &#34;count&#34;&#125;, json&#10;13368&#10;iex(30)&#62; :ej.get &#123;&#34;tags&#34;, 1, &#34;name&#34;&#125;, json&#10;&#34;&#21704;&#21033;&#27874;&#29305;&#34;&#10;iex(31)&#62; :ej.get &#123;&#34;tags&#34;, 1, &#34;title&#34;&#125;, json&#10;&#34;&#21704;&#21033;&#27874;&#29305;&#34;&#10;iex(32)&#62; :ej.get &#123;&#34;tags&#34;, 2, &#34;title&#34;&#125;, json&#10;&#34;J.K.&#32599;&#29747;&#34;&#10;iex(33)&#62; :ej.get &#123;&#34;tags&#34;, 3, &#34;title&#34;&#125;, json&#10;&#34;&#39764;&#24187;&#34;&#10;iex(34)&#62; :ej.get &#123;&#34;tags&#34;, 3, &#34;count&#34;&#125;, json&#10;8892</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-13T07:53:40.000Z"><a href="/2014/12/13/elixir-build-an-irc-logger/">2014-12-13</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/13/elixir-build-an-irc-logger/">构建一个IRC记录程序</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>IRC日志记录程序主要解决时区的问题, 如果你的IRC客户端不是一直连接到IRC服务器, 那么可能错过很多精彩的讨论. 即使你一直开着你的IRC客户端,也可能由于网络的不问题导致IRC客户端断开.下面用Elixir开发的一个IRC日志程序用于记录IRC服务器各个频道的聊天记录, 可以通过日期查看所有订阅频道的聊天信息.</p>
<p>##</p>
<p><img src="/assets/images/c429860617d7d0f4f5794903355570421decac1f_687474703a2f2f692e696d6775722e636f6d2f454471574562682e706e67.png" alt="IRC日志记录器用户界面"></p>
<h2 id="先决条件">先决条件</h2><ol>
<li>需要安装Erlang OTP/17</li>
<li>需要安装Elixir 1.0.1以上版本</li>
</ol>
<h2 id="创建项目">创建项目</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>mix new exile</span><br><span class="line">* creating <span class="constant">README.</span>md</span><br><span class="line">* creating .gitignore</span><br><span class="line">* creating mix.exs</span><br><span class="line">* creating config</span><br><span class="line">* creating config/config.exs</span><br><span class="line">* creating lib</span><br><span class="line">* creating lib/exile.ex</span><br><span class="line">* creating test</span><br><span class="line">* creating test/test_helper.exs</span><br><span class="line">* creating test/exile_test.exs</span><br></pre></td></tr></table></figure>
<p>编译, (直接执行<code>make test</code>可以自动编译并测试)</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>cd exile</span><br><span class="line">mix test</span><br></pre></td></tr></table></figure>
<h2 id="添加第三方库">添加第三方库</h2><p>在<code>deps</code>函数添加第三方库<code>:socket</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Exile</span></span>.<span class="constant">Mixfile </span><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="constant">Mix.Project</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">project</span></span> <span class="keyword">do</span></span><br><span class="line">    [<span class="symbol">app:</span> <span class="symbol">:exile</span>,</span><br><span class="line">     <span class="symbol">version:</span> <span class="string">"0.0.1"</span>,</span><br><span class="line">     <span class="symbol">elixir:</span> <span class="string">"~&gt; 1.0"</span>,</span><br><span class="line">     <span class="symbol">deps:</span> deps]</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">application</span></span> <span class="keyword">do</span></span><br><span class="line">    [<span class="symbol">applications:</span> [<span class="symbol">:logger</span>]]</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">deps</span></span> <span class="keyword">do</span></span><br><span class="line">    [</span><br><span class="line">      &#123;<span class="symbol">:socket</span>, <span class="string">"~&gt; 0.2.8"</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>下载第三方依赖库文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mix deps.get&#10;Running dependency resolution&#10;Unlocked:   timex, socket&#10;Dependency resolution completed successfully&#10;  socket: v0.2.8&#10;* Getting socket (Hex package)&#10;Checking package (https://s3.amazonaws.com/s3.hex.pm/tarballs/socket-0.2.8.tar)&#10;Using locally cached package&#10;Unpacked package tarball (/Users/benjamintan/.hex/packages/socket-0.2.8.tar)</span><br></pre></td></tr></table></figure>
<h2 id="构建机器人程序">构建机器人程序</h2><p>该机器人程序主要用于连接到IRC服务器,并箭筒IRC服务器的频道聊天信息, 并记录到数据库中.</p>
<h3 id="创建bot-ex">创建bot.ex</h3><p><code>Exile.Bot</code>模块使用了<code>GenServer</code>行为, 用于构建通用服务器程序, 使用GenServer的优点是, 它可以被添加到Supervisor进程树中,对其状态进行监控.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defmodule Exile.Bot do&#10;  use GenServer&#10;end</span><br></pre></td></tr></table></figure>
<h3 id="实现需要的回调函数">实现需要的回调函数</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Exile</span></span>.<span class="constant">Bot </span><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="constant">GenServer</span></span><br><span class="line">  <span class="variable">@doc</span> <span class="string">""</span><span class="string">"</span><br><span class="line">  调用start_link初始化,传递一个状态state, state是一个Map, 比如:</span><br><span class="line">  %&#123;</span><br><span class="line">    host: "</span>irc.freenode.net<span class="string">",</span><br><span class="line">    port: 6667,</span><br><span class="line">    chan: "</span><span class="comment">#elixir-lang",</span></span><br><span class="line">    <span class="symbol">nick:</span> <span class="string">"elixir-bot"</span>,</span><br><span class="line">    <span class="symbol">sock:</span> socket</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">""</span><span class="string">"</span><br><span class="line">  def start_link(state) do</span><br><span class="line">    GenServer.start_link(__MODULE__, state)</span><br><span class="line">  end</span><br><span class="line">  @doc "</span><span class="string">""</span></span><br><span class="line">  创建一个到<span class="constant">IRC服</span>务器的套接字连接</span><br><span class="line">  <span class="string">""</span><span class="string">"</span><br><span class="line">  def init(state) do</span><br><span class="line">    &#123;:ok, sock&#125; = Socket.TCP.connect(state.host, state.port, packet: :line)</span><br><span class="line">    # 第三个参数0标识超时, 0为立即超时,并发生一个:timeout消息</span><br><span class="line">    &#123;:ok, %&#123;state | sock: sock&#125;, 0&#125;</span><br><span class="line">  end</span><br><span class="line">  @doc "</span><span class="string">""</span></span><br><span class="line">  超时处理回调函数</span><br><span class="line">  <span class="string">""</span><span class="string">"</span><br><span class="line">  def handle_info(:timeout, state) do</span><br><span class="line">    IO.puts "</span><span class="constant">TIMEOUT HANDLED"</span></span><br><span class="line">    &#123; <span class="symbol">:noreply</span>, state &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="连接到IRC服务器">连接到IRC服务器</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_info</span></span>(<span class="symbol">:timeout</span>, state) <span class="keyword">do</span></span><br><span class="line">  state |&gt; do_join_channel |&gt; do_listen</span><br><span class="line">  &#123; <span class="symbol">:noreply</span>, state &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="进入一个频道">进入一个频道</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">do_join_channel</span></span>(%&#123;<span class="symbol">sock:</span> sock&#125; = state) <span class="keyword">do</span></span><br><span class="line">  sock |&gt; <span class="constant">Socket.Stream.</span>send!(<span class="string">"NICK <span class="subst">#&#123;state.nick&#125;</span>\r\n"</span>)</span><br><span class="line">  sock |&gt; <span class="constant">Socket.Stream.</span>send!(<span class="string">"USER <span class="subst">#&#123;state.nick&#125;</span> <span class="subst">#&#123;state.host&#125;</span> <span class="subst">#&#123;state.nick&#125;</span> <span class="subst">#&#123;state.nick&#125;</span>\r\n"</span>)</span><br><span class="line">  sock |&gt; <span class="constant">Socket.Stream.</span>send!(<span class="string">"JOIN <span class="subst">#&#123;state.chan&#125;</span>\r\n"</span>)</span><br><span class="line">  state</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="监听回复信息">监听回复信息</h2><p>进入频道后就可以通过下面的回调获取聊天信息</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">do_listen</span></span>(%&#123;<span class="symbol">sock:</span> sock&#125; = state) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> state.sock |&gt; <span class="constant">Socket.Stream.</span>recv! <span class="keyword">do</span></span><br><span class="line">    data <span class="keyword">when</span> is_binary(data)-&gt;</span><br><span class="line">      <span class="keyword">case</span> parse_message(data, sock) <span class="keyword">do</span></span><br><span class="line">        message -&gt;</span><br><span class="line">          message</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      do_listen(state)</span><br><span class="line">    <span class="keyword">nil</span> -&gt;</span><br><span class="line">      <span class="symbol">:ok</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="保持连接">保持连接</h2><h2 id="处理其他消息">处理其他消息</h2><h2 id="参考资料">参考资料</h2><ol>
<li>Building an IRC Logger in Elixir<br><a href="http://www.neo.com/2014/12/01/building-an-irc-logger-in-elixir" target="_blank" rel="external">http://www.neo.com/2014/12/01/building-an-irc-logger-in-elixir</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-13T06:11:19.000Z"><a href="/2014/12/13/erlang-100-questions/">2014-12-13</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/13/erlang-100-questions/">Erlang 100问</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="Supervisor_的_simple_one_for_one_有什么关键性特点?">Supervisor 的 simple_one_for_one 有什么关键性特点?</h2><ol>
<li>Supervisor本身启动时不会启动子进程, 子进程的启动必须调用<code>supervisor:start_child(Sup, Args)</code>来启动.</li>
<li>只能有一种子进程定义(规范)</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-08T02:20:31.000Z"><a href="/2014/12/08/nodejs-loopback-model-relations/">2014-12-08</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/08/nodejs-loopback-model-relations/">Loopback 模型关系</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>TODO::</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-12-07T16:26:35.000Z"><a href="/2014/12/08/nodejs-loopback-database-connector-example/">2014-12-08</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/08/nodejs-loopback-database-connector-example/">Loopback 数据库连接器示例</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>创建一个Loopback 应用程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slc loopback # &#21019;&#24314;&#39033;&#30446;longfor&#10;cd longfor</span><br></pre></td></tr></table></figure>
<p>项目创建好了之后, 在项目目录longfor下执行 <code>npm install --save loopback-connector-mysql</code> 安装MySQL数据库连接器</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> $ npm install --save loopback-connector-mysql&#10;npm http GET https://registry.npmjs.org/loopback-connector-mysql&#10;...&#10;...&#10;...&#10;loopback-connector-mysql@1.4.9 node_modules/loopback-connector-mysql&#10;&#9500;&#9472;&#9472; sl-blip@1.0.0&#10;&#9500;&#9472;&#9472; loopback-connector@1.2.0&#10;&#9500;&#9472;&#9472; async@0.9.0&#10;&#9500;&#9472;&#9472; debug@2.0.0 (ms@0.6.2)&#10;&#9492;&#9472;&#9472; mysql@2.5.3 (require-all@0.0.8, bignumber.js@1.4.1, readable-stream@1.1.13)</span><br></pre></td></tr></table></figure>
<p>添加数据源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slc loopback:datasource longfordb</span><br></pre></td></tr></table></figure>
<p>编辑数据源配置文件,添加数据库连接信息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "db": &#123;</span><br><span class="line">    "name": "db",</span><br><span class="line">    "connector": "memory"</span><br><span class="line">  &#125;,</span><br><span class="line">  "longfordb": &#123;</span><br><span class="line">    "name": "longfordb",</span><br><span class="line">    "connector": "mysql",</span><br><span class="line">    "host": "localhost",        # Added</span><br><span class="line">    "port": 3306,               # Added</span><br><span class="line">    "database": "longfor",      # Added</span><br><span class="line">    "username": "root",         # Added</span><br><span class="line">    "password": "root"          # Added</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加模型<code>account</code>,并创建模型<code>account</code>的三个属性: email, created, modified</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slc loopback:model account&#10;Enter an empty property name when done.&#10;? Property name: email&#10;   invoke   loopback:property&#10;? Property type: string&#10;? Required? Yes&#10;&#10;Let&#39;s add another account property.&#10;Enter an empty property name when done.&#10;? Property name: created&#10;   invoke   loopback:property&#10;? Property type: date&#10;? Required? Yes&#10;&#10;Let&#39;s add another account property.&#10;Enter an empty property name when done.&#10;? Property name: modified&#10;   invoke   loopback:property&#10;? Property type: date&#10;? Required? Yes</span><br></pre></td></tr></table></figure>
<p>创建表并添加测试数据, 下载<a href="https://raw.githubusercontent.com/strongloop/loopback-example-database/master/server/create-test-data.js" target="_blank" rel="external">create-test-data.js</a>脚本, 修改数据源名称为longfordb:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#20462;&#25913;&#10;var dataSource = server.dataSources.accountDB;&#10;# &#20026;&#10;var dataSource = server.dataSources.longfordb;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd server&#10;$ node create-test-data.js&#10;Record created: &#123; email: &#39;foo@bar.com&#39;,&#10;  created: Mon Dec 08 2014 00:43:16 GMT+0800 (CST),&#10;  modified: Mon Dec 08 2014 00:43:16 GMT+0800 (CST),&#10;  id: 1 &#125;&#10;Record created: &#123; email: &#39;bar@bar.com&#39;,&#10;  created: Mon Dec 08 2014 00:43:16 GMT+0800 (CST),&#10;  modified: Mon Dec 08 2014 00:43:16 GMT+0800 (CST),&#10;  id: 2 &#125;&#10;done</span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li>loopback-example-database<br><a href="https://github.com/strongloop/loopback-example-database/blob/master/README.md" target="_blank" rel="external">https://github.com/strongloop/loopback-example-database/blob/master/README.md</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-11-29T18:30:13.000Z"><a href="/2014/11/30/opencart-memcache-vqmod/">2014-11-30</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/30/opencart-memcache-vqmod/">Opencart 通过vQmod方式用Memcache替换默认的Cache</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="前提条件">前提条件</h2><p>用Memcache替换默认的Cache之前,需要满足如下前提条件:</p>
<ul>
<li>PHP需要Memcache扩展, 可以通过如下方式安装, 并在<code>php.ini</code>配置文件中添加<code>extension=memcache.so</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pecl install memcache</span><br></pre></td></tr></table></figure>
<ul>
<li>需要安装配置好Opencart</li>
<li>需要安装vQmod</li>
</ul>
<h2 id="vQmod模块代码">vQmod模块代码</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">modification</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">id</span>&gt;</span>Replace opencart default cache with Memcache<span class="tag">&lt;/<span class="title">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">vqmver</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="title">vqmver</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">author</span>&gt;</span>hezhiqiang<span class="tag">&lt;/<span class="title">author</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">file</span> <span class="attribute">name</span>=<span class="value">"system/library/cache.php"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">operation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">search</span> <span class="attribute">position</span>=<span class="value">"replace"</span> <span class="attribute">offset</span>=<span class="value">"50"</span>&gt;</span><span class="cdata">&lt;![CDATA[</span><br><span class="line">			&lt;?php</span><br><span class="line">			]]&gt;</span><span class="tag">&lt;/<span class="title">search</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">add</span>&gt;</span><span class="cdata">&lt;![CDATA[&lt;?php</span><br><span class="line">/**</span><br><span class="line"> * OpenCart Ukrainian Community</span><br><span class="line"> *</span><br><span class="line"> * LICENSE</span><br><span class="line"> *</span><br><span class="line"> * This source file is subject to the GNU General Public License, Version 3</span><br><span class="line"> * It is also available through the world-wide-web at this URL:</span><br><span class="line"> * http://www.gnu.org/copyleft/gpl.html</span><br><span class="line"> * If you did not receive a copy of the license and are unable to</span><br><span class="line"> * obtain it through the world-wide-web, please send an email</span><br><span class="line"> *</span><br><span class="line"> * @category   OpenCart</span><br><span class="line"> * @package    OCU Memcached</span><br><span class="line"> * @copyright  Copyright (c) 2011 created by UncleAndy, maintained by Eugene Lifescale for</span><br><span class="line">               OpenCart Ukrainian Community (http://opencart-ukraine.tumblr.com)</span><br><span class="line"> * @license    http://www.gnu.org/copyleft/gpl.html</span><br><span class="line">               GNU General Public License, Version 3</span><br><span class="line"> */</span><br><span class="line">final class Cache</span><br><span class="line">&#123;</span><br><span class="line">    private $expire;</span><br><span class="line">    private $memcache;</span><br><span class="line">    private $ismemcache = false;</span><br><span class="line">    public function __construct($exp = 3600)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;expire = $exp;</span><br><span class="line">        if (CACHE_DRIVER == 'memcached') &#123;</span><br><span class="line">            $mc = new Memcache;</span><br><span class="line">            if ($mc-&gt;pconnect(MEMCACHE_HOSTNAME, MEMCACHE_PORT)) &#123;</span><br><span class="line">                $this-&gt;memcache = $mc;</span><br><span class="line">                $this-&gt;ismemcache = true;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">        $files = glob(DIR_CACHE . 'cache.*');</span><br><span class="line">        if ($files) &#123;</span><br><span class="line">            foreach ($files as $file) &#123;</span><br><span class="line">                $time = substr(strrchr($file, '.'), 1);</span><br><span class="line">                if ($time &lt; time()) &#123;</span><br><span class="line">                    if (file_exists($file)) &#123;</span><br><span class="line">                        @unlink($file);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public function get($key)</span><br><span class="line">    &#123;</span><br><span class="line">        if ((CACHE_DRIVER == 'memcached') &amp;&amp; $this-&gt;ismemcache) &#123;</span><br><span class="line">            return ($this-&gt;memcache-&gt;get(MEMCACHE_NAMESPACE . $key, 0));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $files = glob(DIR_CACHE . 'cache.' . $key . '.*');</span><br><span class="line">            if ($files) &#123;</span><br><span class="line">                foreach ($files as $file) &#123;</span><br><span class="line">                    $cache = '';</span><br><span class="line">                    $handle = fopen($file, 'r');</span><br><span class="line">                    if ($handle) &#123;</span><br><span class="line">                        $cache = fread($handle, filesize($file));</span><br><span class="line">                        fclose($handle);</span><br><span class="line">                    &#125;</span><br><span class="line">                    return unserialize($cache);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public function set($key, $value)</span><br><span class="line">    &#123;</span><br><span class="line">        if ((CACHE_DRIVER == 'memcached') &amp;&amp; $this-&gt;ismemcache) &#123;</span><br><span class="line">            $this-&gt;memcache-&gt;set(MEMCACHE_NAMESPACE . $key, $value, MEMCACHE_COMPRESSED, $this-&gt;expire);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;delete($key);</span><br><span class="line">            $file = DIR_CACHE . 'cache.' . $key . '.' . (time() + $this-&gt;expire);</span><br><span class="line">            $handle = fopen($file, 'w');</span><br><span class="line">            fwrite($handle, serialize($value));</span><br><span class="line">            fclose($handle);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function delete($key)</span><br><span class="line">    &#123;</span><br><span class="line">        if ((CACHE_DRIVER == 'memcached') &amp;&amp; $this-&gt;ismemcache) &#123;</span><br><span class="line">            $this-&gt;memcache-&gt;delete(MEMCACHE_NAMESPACE . $key, 0);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $files = glob(DIR_CACHE . 'cache.' . $key . '.*');</span><br><span class="line">            if ($files) &#123;</span><br><span class="line">                foreach ($files as $file) &#123;</span><br><span class="line">                    if (file_exists($file)) &#123;</span><br><span class="line">                        @unlink($file);</span><br><span class="line">                        clearstatcache();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">			]]&gt;</span><span class="tag">&lt;/<span class="title">add</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">operation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">modification</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-11-26T09:23:04.000Z"><a href="/2014/11/26/opencart-vqmod/">2014-11-26</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/26/opencart-vqmod/">Opencart vqmod 虚拟文件修改系统</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="简介">简介</h2><p>vQmod™ - Virtual File Modification System<br><a href="http://vqmod.com" target="_blank" rel="external">http://vqmod.com</a></p>
<p>假设Opencart的安装目录为<code>$OPENCART</code></p>
<p><img src="/assets/opencart/66988307-85C2-4148-AC43-9C0857325704.png" alt="vQmod安装前后$OPENCART/index.php的差异"></p>
<h2 id="分类导入导出工具">分类导入导出工具</h2>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-11-22T13:44:48.000Z"><a href="/2014/11/22/nodejs-loopback-getstarted/">2014-11-22</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/22/nodejs-loopback-getstarted/">Loopback框架入门</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="安装strongloop框架">安装strongloop框架</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g strongloop</span><br></pre></td></tr></table></figure>
<h2 id="创建项目">创建项目</h2><p>运行 <code>slc loopback</code>, 提示输入项目信息, 包括项目名称, 目录名称等.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ slc loopback&#10;[?] Enter a directory name where to create the project: longfor&#10;[?] What&#39;s the name of your application? longfor</span><br></pre></td></tr></table></figure>
<p>上述过程创建了一个名为longfor的项目, 目录名称也为longfor.</p>
<h2 id="创建模型">创建模型</h2><p>进入 longfor 目录执行 <code>slc loopback:model</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd longfor&#10;$ slc loopback:model&#10;[?] Enter the model name: user&#10;[?] Select the data-source to attach person to: db (memory)&#10;[?] Expose person via the REST API? Yes&#10;[?] Custom plural form (used to build REST URL): people&#10;Let&#39;s add some person properties now.</span><br></pre></td></tr></table></figure>
<h2 id="安装数据库连接器">安装数据库连接器</h2><p>这里的例子, 我们以MySQL作为例子:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save loopback-connector-mysql</span><br></pre></td></tr></table></figure>
<h2 id="添加数据源">添加数据源</h2><p>数据库连接器安装好了之后, 我们需要为我们的应用添加数据源, 通过下面的命令给应用程序longfor添加数据源, 数据源的名称为longfordb, MySQL作为连接器:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ slc loopback:datasource longfordb&#10;? Enter the data-source name: longfordb&#10;? Select the connector for longfordb: (Use arrow keys)&#10;&#10095; In-memory db (supported by StrongLoop)&#10;  Email (supported by StrongLoop)&#10;  MySQL (supported by StrongLoop)&#10;  PostgreSQL (supported by StrongLoop)&#10;  Oracle (supported by StrongLoop)&#10;  Microsoft SQL (supported by StrongLoop)&#10;  MongoDB (supported by StrongLoop)</span><br></pre></td></tr></table></figure>
<p>数据源创建好了, 接下来就是配置数据源, 让代码可以通过我们刚才创建的这个数据源名称去和后端数据库建立连接:</p>
<h2 id="配置数据源">配置数据源</h2><p>数据源的配置文件在目录<code>$PROJECT/server/datasources.json</code>, 修改内容为:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#10;  ...&#10;  &#34;longfordb&#34;: &#123;&#10;    &#34;name&#34;: &#34;longfordb&#34;,&#10;    &#34;connector&#34;: &#34;mysql&#34;,&#10;    &#34;host&#34;: &#34;localhost&#34;,&#10;    &#34;port&#34;: 3306,&#10;    &#34;database&#34;: &#34;longfordb&#34;,&#10;    &#34;username&#34;: &#34;root&#34;,&#10;    &#34;password&#34;: &#34;root&#34;&#10;  &#125;&#10;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="关于模型">关于模型</h2><p>关于模型Loopback有几个内置的模型类</p>
<ul>
<li><code>PersistedModel</code><br>该模型类继承自<code>Model</code>类,额外支持基本查询功能和CRUD操作.</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-11-21T09:34:44.000Z"><a href="/2014/11/21/semver-libraries/">2014-11-21</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/21/semver-libraries/">Node.js语义版本解析库</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>安装语义版本解析库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g semver</span><br></pre></td></tr></table></figure>
<p>Node Shell示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#62; var semver = require(&#39;semver&#39;);&#10;undefined&#10;&#62; var version_info = semver.parse(&#39;1.2.3&#39;);&#10;undefined&#10;&#62; version_info.major&#10;1&#10;&#62; version_info.minor&#10;2&#10;&#62; version_info.patch&#10;3</span><br></pre></td></tr></table></figure>
<p>验证一个版本号是否是语义化版本, 如果是一个语义化版本返回<code>true</code>, 否则返回<code>false</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">semver.valid(&#39;1.2.3&#39;)</span><br></pre></td></tr></table></figure>
<h2 id="其他语言版本">其他语言版本</h2><ul>
<li><code>Erlang</code><br><a href="https://github.com/nebularis/semver" target="_blank" rel="external">https://github.com/nebularis/semver</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2014-11-21T03:41:09.000Z"><a href="/2014/11/21/elixir-tasks/">2014-11-21</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/21/elixir-tasks/">任务</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="什么是任务?">什么是任务?</h2><p>任务是进程, 是用于执行特定动作的进程, 通常较少或不与其他进程通信. 任务最常用的情况是异步地计算一个值.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">task = Task.async(fn -&#62; do_some_work() end)&#10;res  = do_some_other_work()&#10;res + Task.await(task)</span><br></pre></td></tr></table></figure>
<p>任务通常不返回值, 但是有时候我们需要让任务计算一个值,随后读取其计算结果.</p>
<p><code>async/await</code> 提供了一个非常简单的机制并发地计算.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(foo@44adb2a6d305)2&#62; task = Task.async(fn -&#62; :math.pow(7,2) + :math.pow(8,2) end)&#10;%Task&#123;pid: #PID&#60;0.97.0&#62;, ref: #Reference&#60;0.0.0.238&#62;&#125;&#10;iex(foo@44adb2a6d305)3&#62; Task.await(task)&#10;113.0</span><br></pre></td></tr></table></figure>
<p>首先来说明异步, <code>Task.async/1</code>创建一个任务,并执行传递给它的函数, 如上述代码第2行所示, <code>Task.async/1</code>调用返回一个对任务的引用.</p>
<p>这行输出很好地阐述了文章开头这么一句话<code>任务是进程</code>.该输出实际上是一个<code>%Task</code> Map, 包含两个元素 进程的Pid, 以及一个引用对象.</p>
<p>随后可以通过调用<code>Task.await/1</code>获取其计算结果. 调用<code>Task.async/1</code>会创建一个新的进程,该进程连接到调用者进程. 任务结果以消息的形式返回给调用者进程.<br><code>Task.await/2</code>用于读取由任务发送的消息.</p>
<p>创建任务<code>task1</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(foo@44adb2a6d305)4&#62; task1 = Task.async(fn -&#62; :math.pow(7,2) + :math.pow(8,2) end)&#10;%Task&#123;pid: #PID&#60;0.100.0&#62;, ref: #Reference&#60;0.0.0.245&#62;&#125;</span><br></pre></td></tr></table></figure>
<p>创建任务<code>task2</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(foo@44adb2a6d305)6&#62; task2 = Task.async(fn -&#62; 2+2 end)&#10;%Task&#123;pid: #PID&#60;0.103.0&#62;, ref: #Reference&#60;0.0.0.252&#62;&#125;</span><br></pre></td></tr></table></figure>
<p>分别获取两个任务的计算结果 <code>v1</code>, <code>v2</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1 = Task.await(task1)&#10;v2 = Task.await(task2)</span><br></pre></td></tr></table></figure>
<p>再通过第三个任务<code>task3</code>合并计算两个任务的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(foo@44adb2a6d305)15&#62; task3 = Task.async(fn -&#62; v1 + v2 end)&#10;%Task&#123;pid: #PID&#60;0.117.0&#62;, ref: #Reference&#60;0.0.0.288&#62;&#125;&#10;iex(foo@44adb2a6d305)16&#62; Task.await(task3)&#10;117.0</span><br></pre></td></tr></table></figure>
<p>还可以通过<code>start_link/1</code>和<code>start_link/3</code>创建任务并挂在到Supervition树中.</p>
<p>和<code>Task.async/1</code>不同,<code>Task.start_link/1</code>返回的是一个<code>{:ok,pid}</code>而不是一个任务引用,因此我无法通过<code>Task.await/2</code>获取其计算结果.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex(foo@44adb2a6d305)21&#62; Task.start_link(fn -&#62; 1 + 1 end)&#10;&#123;:ok, #PID&#60;0.128.0&#62;&#125;</span><br></pre></td></tr></table></figure>
<p>这样的任务可以挂在到supervision树, 下面的代码片段显示了如何挂载一个任务到一个supervision树中:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import Supervisor.Spec&#10;children = [&#10;    worker(Task, [fn -&#62; IO.puts &#34;ok&#34; end])&#10;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过上述几个步骤,我们实现了并发处理. 下面阐述如何把任务分布到集群中的多个节点从而实现分布式.</p>
</blockquote>
<h2 id="Supervision_树">Supervision 树</h2><p><code>Task.Supervisor</code>模块允许开发者创建可动态第添加任务的监控进程(Supervisors):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;:ok, pid&#125; = Task.Supervisor.start_link()&#10;Task.Supervisor.async(pid, Module, :function, [arg1, arg2, arg3])</span><br></pre></td></tr></table></figure>
<p><code>Task.Supervisor</code>还可以在远程节点上创建任务, 只要该监控进程在本地或全局注册过:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#22312;&#36828;&#31243;&#33410;&#28857;&#10;Task.Supervisor.start_link(name: :tasks_sup)&#10;# &#22312;&#23458;&#25143;&#31471;&#10;Task.Supervisor.async(&#123;:tasks_sup, :&#39;bar@192.168.8.8&#39;&#125;, Module, :function, [arg1, arg2, arg3])</span><br></pre></td></tr></table></figure>
<p><code>Task.Supervisor</code>通常在监控树中以下列方式启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import Supervisor.Spec&#10;children = [&#10;    supervisor(Task.Supervisor, [[name: :tasks_sup]&#10;]</span><br></pre></td></tr></table></figure>
<p>需要注意的是, 当处理分布式任务时, 应该使用<code>async/3</code>, 分别传递模块,函数,参数列表, 而不是以一个匿名函数作为参数的<code>async/1</code>.</p>
<h2 id="分布_(Distrbuted)">分布 (Distrbuted)</h2><p>TODO::</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/4/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div>
    </div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/11/02/elixir-failover-and-takeover/">故障转移和接管</a>
      </li>
    
      <li>
        <a href="/2015/09/17/ejabberd-with-elixir-mix/">用Elixir Mix构建Ejabberd发行包</a>
      </li>
    
      <li>
        <a href="/2015/06/05/uftp/">UFTP - 基于UDP的加密文件多播传输协议</a>
      </li>
    
      <li>
        <a href="/2015/06/04/html5-web-cryptography-api-hashing/">Web加密API - 散列(Hashing)</a>
      </li>
    
      <li>
        <a href="/2015/06/04/the-3-modes-of-http-protocol/">HTTP协议的三种模式</a>
      </li>
    
      <li>
        <a href="/2015/05/21/ejabberd-with-elixir-packet-filters/">Ejabberd 用Elixir开发一个包过滤模块</a>
      </li>
    
      <li>
        <a href="/2015/05/18/chrome-dev-get-started/">Chrome 开发入门</a>
      </li>
    
      <li>
        <a href="/2015/05/18/html5-web-cryptography-api-tutorial/">Web加密API指南</a>
      </li>
    
      <li>
        <a href="/2015/05/17/html5-battery-status/">HTML5获取电池状态</a>
      </li>
    
      <li>
        <a href="/2015/05/10/ejabberd-mam-module-how-to-use/">如何使用Ejabberd消息归档模块</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/AD/">AD</a><small>2</small></li>
  
    <li><a href="/categories/API/">API</a><small>3</small></li>
  
    <li><a href="/categories/Chrome/">Chrome</a><small>1</small></li>
  
    <li><a href="/categories/Continuous-Deployment/">Continuous Deployment</a><small>1</small></li>
  
    <li><a href="/categories/Database/">Database</a><small>1</small></li>
  
    <li><a href="/categories/Docker/">Docker</a><small>9</small></li>
  
    <li><a href="/categories/Ejabberd/">Ejabberd</a><small>36</small></li>
  
    <li><a href="/categories/Elixir/">Elixir</a><small>42</small></li>
  
    <li><a href="/categories/Erlang/">Erlang</a><small>20</small></li>
  
    <li><a href="/categories/HTML5/">HTML5</a><small>3</small></li>
  
    <li><a href="/categories/HTTP/">HTTP</a><small>1</small></li>
  
    <li><a href="/categories/HTTP2/">HTTP2</a><small>1</small></li>
  
    <li><a href="/categories/Javascript/">Javascript</a><small>14</small></li>
  
    <li><a href="/categories/Linux/">Linux</a><small>4</small></li>
  
    <li><a href="/categories/MySQL/">MySQL</a><small>2</small></li>
  
    <li><a href="/categories/Node-js/">Node.js</a><small>17</small></li>
  
    <li><a href="/categories/Opencart/">Opencart</a><small>2</small></li>
  
    <li><a href="/categories/QA/">QA</a><small>2</small></li>
  
    <li><a href="/categories/RESTFul/">RESTFul</a><small>1</small></li>
  
    <li><a href="/categories/SCM/">SCM</a><small>5</small></li>
  
    <li><a href="/categories/Testing/">Testing</a><small>1</small></li>
  
    <li><a href="/categories/Thrift/">Thrift</a><small>1</small></li>
  
    <li><a href="/categories/Tools/">Tools</a><small>4</small></li>
  
    <li><a href="/categories/Web/">Web</a><small>6</small></li>
  
    <li><a href="/categories/XEP/">XEP</a><small>5</small></li>
  
    <li><a href="/categories/XMPP/">XMPP</a><small>7</small></li>
  
    <li><a href="/categories/english/">english</a><small>1</small></li>
  
    <li><a href="/categories/杂类/">杂类</a><small>1</small></li>
  
  </ul>
</div>


  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/AD/" style="font-size: 10px;">AD</a> <a href="/tags/API/" style="font-size: 11.11px;">API</a> <a href="/tags/Analysis/" style="font-size: 10px;">Analysis</a> <a href="/tags/Battery-Status/" style="font-size: 10px;">Battery Status</a> <a href="/tags/Behaviour/" style="font-size: 10px;">Behaviour</a> <a href="/tags/CUPS/" style="font-size: 10px;">CUPS</a> <a href="/tags/CURL/" style="font-size: 10px;">CURL</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/Clustering/" style="font-size: 10px;">Clustering</a> <a href="/tags/Distributed/" style="font-size: 10px;">Distributed</a> <a href="/tags/Distributed-Application/" style="font-size: 10px;">Distributed Application</a> <a href="/tags/ETS/" style="font-size: 10px;">ETS</a> <a href="/tags/Ecto/" style="font-size: 11.11px;">Ecto</a> <a href="/tags/Elixir/" style="font-size: 20px;">Elixir</a> <a href="/tags/Erlang/" style="font-size: 10px;">Erlang</a> <a href="/tags/Escalus/" style="font-size: 10px;">Escalus</a> <a href="/tags/ExUnit/" style="font-size: 10px;">ExUnit</a> <a href="/tags/Exrm/" style="font-size: 10px;">Exrm</a> <a href="/tags/H2O/" style="font-size: 10px;">H2O</a> <a href="/tags/Hex-pm/" style="font-size: 10px;">Hex.pm</a> <a href="/tags/HiPE/" style="font-size: 10px;">HiPE</a> <a href="/tags/Howto/" style="font-size: 10px;">Howto</a> <a href="/tags/Http-modes/" style="font-size: 10px;">Http modes</a> <a href="/tags/Httpotion/" style="font-size: 10px;">Httpotion</a> <a href="/tags/I18n/" style="font-size: 10px;">I18n</a> <a href="/tags/IAB/" style="font-size: 10px;">IAB</a> <a href="/tags/ID3/" style="font-size: 10px;">ID3</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/IOT/" style="font-size: 10px;">IOT</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/Loopback/" style="font-size: 12.22px;">Loopback</a> <a href="/tags/MUC/" style="font-size: 10px;">MUC</a> <a href="/tags/Macro/" style="font-size: 12.22px;">Macro</a> <a href="/tags/Memcache/" style="font-size: 10px;">Memcache</a> <a href="/tags/Mix/" style="font-size: 14.44px;">Mix</a> <a href="/tags/Modules/" style="font-size: 10px;">Modules</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OSM-Building/" style="font-size: 10px;">OSM Building</a> <a href="/tags/OTP/" style="font-size: 12.22px;">OTP</a> <a href="/tags/OpenStreetMap/" style="font-size: 10px;">OpenStreetMap</a> <a href="/tags/Optimization/" style="font-size: 10px;">Optimization</a> <a href="/tags/PM2/" style="font-size: 10px;">PM2</a> <a href="/tags/Performance/" style="font-size: 10px;">Performance</a> <a href="/tags/Phoenix/" style="font-size: 12.22px;">Phoenix</a> <a href="/tags/Pool/" style="font-size: 10px;">Pool</a> <a href="/tags/PostgreSQL/" style="font-size: 10px;">PostgreSQL</a> <a href="/tags/RESTFUL/" style="font-size: 11.11px;">RESTFUL</a> <a href="/tags/RMAL/" style="font-size: 10px;">RMAL</a> <a href="/tags/Ranch/" style="font-size: 10px;">Ranch</a> <a href="/tags/RefactorErl/" style="font-size: 10px;">RefactorErl</a> <a href="/tags/Regex/" style="font-size: 10px;">Regex</a> <a href="/tags/Resource-Pool/" style="font-size: 10px;">Resource Pool</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/SemVer/" style="font-size: 10px;">SemVer</a> <a href="/tags/Semantic-UI/" style="font-size: 10px;">Semantic UI</a> <a href="/tags/Sequelize/" style="font-size: 10px;">Sequelize</a> <a href="/tags/Stream-Management/" style="font-size: 10px;">Stream Management</a> <a href="/tags/Sublime/" style="font-size: 10px;">Sublime</a> <a href="/tags/Task/" style="font-size: 10px;">Task</a> <a href="/tags/Thrift/" style="font-size: 11.11px;">Thrift</a> <a href="/tags/Tsung/" style="font-size: 10px;">Tsung</a> <a href="/tags/UBF/" style="font-size: 10px;">UBF</a> <a href="/tags/UFTP/" style="font-size: 10px;">UFTP</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/Umbrella/" style="font-size: 10px;">Umbrella</a> <a href="/tags/VAST/" style="font-size: 10px;">VAST</a> <a href="/tags/VPAID/" style="font-size: 10px;">VPAID</a> <a href="/tags/Web-Cryptography-API/" style="font-size: 11.11px;">Web Cryptography API</a> <a href="/tags/XEP/" style="font-size: 16.67px;">XEP</a> <a href="/tags/XEP-198/" style="font-size: 10px;">XEP-198</a> <a href="/tags/XML/" style="font-size: 10px;">XML</a> <a href="/tags/XMPP/" style="font-size: 17.78px;">XMPP</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/angular/" style="font-size: 16.67px;">angular</a> <a href="/tags/application/" style="font-size: 10px;">application</a> <a href="/tags/blockies/" style="font-size: 10px;">blockies</a> <a href="/tags/bootstrap3/" style="font-size: 10px;">bootstrap3</a> <a href="/tags/bosh/" style="font-size: 12.22px;">bosh</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/container/" style="font-size: 11.11px;">container</a> <a href="/tags/data-management/" style="font-size: 10px;">data management</a> <a href="/tags/data-volume/" style="font-size: 10px;">data volume</a> <a href="/tags/debugging/" style="font-size: 10px;">debugging</a> <a href="/tags/devtools/" style="font-size: 10px;">devtools</a> <a href="/tags/devtools-terminal/" style="font-size: 10px;">devtools-terminal</a> <a href="/tags/doc/" style="font-size: 10px;">doc</a> <a href="/tags/docker/" style="font-size: 15.56px;">docker</a> <a href="/tags/ejabberd/" style="font-size: 18.89px;">ejabberd</a> <a href="/tags/ejabberd-c2s/" style="font-size: 10px;">ejabberd_c2s</a> <a href="/tags/emysql/" style="font-size: 11.11px;">emysql</a> <a href="/tags/encoding/" style="font-size: 10px;">encoding</a> <a href="/tags/erlang/" style="font-size: 12.22px;">erlang</a> <a href="/tags/erlang-mk/" style="font-size: 10px;">erlang.mk</a> <a href="/tags/faq/" style="font-size: 10px;">faq</a> <a href="/tags/gen-tcp/" style="font-size: 10px;">gen_tcp</a> <a href="/tags/gerrit/" style="font-size: 11.11px;">gerrit</a> <a href="/tags/gettext/" style="font-size: 10px;">gettext</a> <a href="/tags/git/" style="font-size: 12.22px;">git</a> <a href="/tags/graphviz/" style="font-size: 10px;">graphviz</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hero/" style="font-size: 10px;">hero</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/iconutil/" style="font-size: 10px;">iconutil</a> <a href="/tags/iq/" style="font-size: 10px;">iq</a> <a href="/tags/jabber/" style="font-size: 10px;">jabber</a> <a href="/tags/javascript/" style="font-size: 11.11px;">javascript</a> <a href="/tags/jiffy/" style="font-size: 10px;">jiffy</a> <a href="/tags/json-schema/" style="font-size: 10px;">json-schema</a> <a href="/tags/library/" style="font-size: 10px;">library</a> <a href="/tags/linking/" style="font-size: 10px;">linking</a> <a href="/tags/lists/" style="font-size: 10px;">lists</a> <a href="/tags/load-balance/" style="font-size: 10px;">load balance</a> <a href="/tags/log4er/" style="font-size: 10px;">log4er</a> <a href="/tags/manage-images/" style="font-size: 10px;">manage images</a> <a href="/tags/mariadb/" style="font-size: 10px;">mariadb</a> <a href="/tags/muc/" style="font-size: 10px;">muc</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/node-reggie/" style="font-size: 10px;">node-reggie</a> <a href="/tags/node-webkit/" style="font-size: 13.33px;">node-webkit</a> <a href="/tags/node-js/" style="font-size: 12.22px;">node.js</a> <a href="/tags/nodemailer/" style="font-size: 10px;">nodemailer</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/npm/" style="font-size: 11.11px;">npm</a> <a href="/tags/performance/" style="font-size: 10px;">performance</a> <a href="/tags/ploymer/" style="font-size: 10px;">ploymer</a> <a href="/tags/polymer/" style="font-size: 10px;">polymer</a> <a href="/tags/port/" style="font-size: 10px;">port</a> <a href="/tags/pubsub/" style="font-size: 10px;">pubsub</a> <a href="/tags/rebar/" style="font-size: 10px;">rebar</a> <a href="/tags/record/" style="font-size: 10px;">record</a> <a href="/tags/recursion/" style="font-size: 10px;">recursion</a> <a href="/tags/regexp/" style="font-size: 10px;">regexp</a> <a href="/tags/relx/" style="font-size: 10px;">relx</a> <a href="/tags/screen/" style="font-size: 10px;">screen</a> <a href="/tags/sequelize/" style="font-size: 10px;">sequelize</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/stanza/" style="font-size: 10px;">stanza</a> <a href="/tags/strophe-js/" style="font-size: 10px;">strophe.js</a> <a href="/tags/strophejs/" style="font-size: 10px;">strophejs</a> <a href="/tags/svg-sprite/" style="font-size: 10px;">svg-sprite</a> <a href="/tags/swagger/" style="font-size: 12.22px;">swagger</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a> <a href="/tags/tls/" style="font-size: 10px;">tls</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/tsung/" style="font-size: 10px;">tsung</a> <a href="/tags/upstart/" style="font-size: 10px;">upstart</a> <a href="/tags/vQmod/" style="font-size: 10px;">vQmod</a> <a href="/tags/varnish/" style="font-size: 10px;">varnish</a> <a href="/tags/vqmod/" style="font-size: 10px;">vqmod</a> <a href="/tags/vt/" style="font-size: 10px;">vt</a> <a href="/tags/win32reg/" style="font-size: 10px;">win32reg</a> <a href="/tags/xml-schema/" style="font-size: 10px;">xml schema</a> <a href="/tags/匆匆那年/" style="font-size: 10px;">匆匆那年</a> <a href="/tags/协议包/" style="font-size: 10px;">协议包</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
</div>
<footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 zhiqiang he
  
</div>
<div class="clearfix"></div></footer>

<!--<script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>-->
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<!--<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });

</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });

</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });

</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-53429135-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>




