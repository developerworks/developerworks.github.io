
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>元气糯米团子的Coding Blog</title>
  <meta name="author" content="zhiqiang he">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="元气糯米团子的Coding Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="元气糯米团子的Coding Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/assets/css/toc.css"/>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>-->
  <script type="text/javascript" src="//upcdn.b0.upaiyun.com/libs/jquery/jquery-1.8.3.min.js"></script>
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href="favicons/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="favicons/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="favicons/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="favicons/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="favicons/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="favicons/apple-touch-icon-76x76.png" />
  <link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16" />
  <meta name="msapplication-TileColor" content="#da532c" />
  <!--
  <SCRIPT type=text/javascript src="/js/scrolltop.js"></SCRIPT>
   -->
  <!--howiefh calendar begin-->
  <SCRIPT type=text/javascript src="/js/calendar.js"></SCRIPT>
  <!--howiefh calendar end-->
  
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-53429135-1', 'auto');
    ga('send', 'pageview');
</script>

</head>


<body>
<header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">元气糯米团子的Coding Blog</a></h1>
  <h2><a href="/">Tansform information as knowledges, extract and purify as thoughts</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">树根</a></li>
    
      <li><a href="/archives">泡菜坛子</a></li>
    
      <li><a href="/links">连接</a></li>
    
      <li><a href="/atom.xml">粽子</a></li>
      
      <li><a href="https://segmentfault.com/blog/developerworks">SegmentFault</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>

<div id="content" class="inner">
    <div id="main-col" class="alignleft">
        <div id="wrapper">
  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-11-11T05:44:58.000Z"><a href="/2015/11/11/ejabberd-http-module/">2015-11-11</a></time>
      
      
  
    <h1 class="title"><a href="/2015/11/11/ejabberd-http-module/">开发一个Ejabberd HTTP模块</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述">概述</h2><p>如何开发一个Ejabberd模块, 本文基于一个实例演示了如何开发一个Ejabberd模块, 以及模块的基本结构.</p>
<p>HTTP模块的核心函数是<code>process(Paths,Requst)</code>处理函数, 接受一个路径列表, 和一个请求作为参数. 返回值为一个三元组<code>{ResponseCode, ResponseHeaders, ResponseBody}</code>, 分别表示响应码, 响应头和响应体. 其中:</p>
<ol>
<li><code>ResponseCode</code>为一个整数值, 例如<code>200</code></li>
<li><code>ResponseHeaders</code>为一个二元组列表, 例如<code>[{&lt;&lt;&quot;Content-Type&quot;&gt;&gt;, &lt;&lt;&quot;text/html; charset=utf-8&quot;&gt;&gt;}]</code>,表示要设置的HTTP响应头信息.</li>
<li><code>ResponseBody</code>为一个类似<code>&lt;&lt;&quot;Content&quot;&gt;&gt;</code>二进制字符串, 返回给客户端的实际内容.</li>
</ol>
<p>具体细节可参考<code>ejabberd_http.erl</code>模块的<code>make_xhtml_output/4</code>函数.</p>
<p>下面是一个<code>process/4</code>函数的例子, 该函数用于获取当前在线用户数, 支持跨域资源共享(CORS):</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">process</span><span class="params">(<span class="variable">_LocalPath</span>, <span class="variable">_Request</span>)</span> -&gt;</span></span><br><span class="line">  <span class="variable">ConnectedUsersNumber</span> = <span class="function_name">ejabberd_sm:connected_users_number</span>(),</span><br><span class="line">  <span class="variable">Json</span> = <span class="function_name">jiffy:encode</span>(<span class="tuple">&#123;[</span><br><span class="line">    <span class="tuple">&#123;connected_users_number, <span class="variable">ConnectedUsersNumber</span>&#125;</span></span><br><span class="line">  ]&#125;</span>),</span><br><span class="line">  <span class="tuple">&#123;<span class="number">200</span>, [</span><br><span class="line">    <span class="tuple">&#123;&lt;&lt;<span class="string">"Access-Control-Allow-Origin"</span>&gt;&gt;,   &lt;&lt;<span class="string">"http://www.example.com"</span>&gt;&gt;&#125;</span>,</span><br><span class="line">    <span class="tuple">&#123;&lt;&lt;<span class="string">"Access-Control-Allow-Headers"</span>&gt;&gt;,  &lt;&lt;<span class="string">"Content-Type,X-Requested-With"</span>&gt;&gt;&#125;</span>,</span><br><span class="line">    <span class="tuple">&#123;&lt;&lt;<span class="string">"Content-Type"</span>&gt;&gt;,                  &lt;&lt;<span class="string">"application/json; charset=utf-8"</span>&gt;&gt;&#125;</span></span><br><span class="line">  ], <span class="variable">Json</span>&#125;</span>.</span><br></pre></td></tr></table></figure>
<p>在线用户数也可通过<code>ejabberdctl connected_users_number</code>获取.</p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/11/11/ejabberd-http-module/#more" class="more-link">阅读全文</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-11-01T18:10:29.000Z"><a href="/2015/11/02/elixir-failover-and-takeover/">2015-11-02</a></time>
      
      
  
    <h1 class="title"><a href="/2015/11/02/elixir-failover-and-takeover/">故障转移和接管</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>2015-11-02 更新</p>
<p>Elixir 可以运行在主/从, 故障转移/接管模式下. 要使Elixir应用程序能够执行故障转移/接管, Elixir应用程序必须是一个OTP应用程序.</p>
<p>下面来创建一个包含Supervisor的Elixir项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix new distro --sup</span><br></pre></td></tr></table></figure>
<p>修改<code>distro.ex</code>添加<code>logger</code>模块. 以记录当触发故障转移/接管操作时的日志记录.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Distro</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="constant">Application</span></span><br><span class="line">  require <span class="constant">Logger</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start</span></span>(type, <span class="constant">_args)</span> <span class="keyword">do</span></span><br><span class="line">    import <span class="constant">Supervisor.Spec,</span> <span class="symbol">warn:</span> <span class="keyword">false</span></span><br><span class="line">    <span class="constant">Logger.</span>info(<span class="string">"Distro application in <span class="subst">#&#123;inspect type&#125;</span> mode"</span>)</span><br><span class="line">    children = [</span><br><span class="line">      worker(<span class="constant">Distro.Worker,</span> [])</span><br><span class="line">    ]</span><br><span class="line">    opts = [<span class="symbol">strategy:</span> <span class="symbol">:one_for_one</span>, <span class="symbol">name:</span> <span class="constant">Distro.Supervisor]</span></span><br><span class="line">    <span class="constant">Supervisor.</span>start_link(children, opts)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><code>Distro.Worker</code>是一个<code>GenServer</code>: 它使用全局名称注册, 假设其运行在集群中的一个节点上, 全局注册让我们不用考虑其实际的运行位置, 只需要提供注册名称就可以访问.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Distro</span></span>.<span class="constant">Worker </span><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="constant">GenServer</span></span><br><span class="line">  require <span class="constant">Logger</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_link</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="constant">GenServer.</span>start_link(<span class="constant">__MODULE__,</span> [], <span class="symbol">name:</span> &#123;<span class="symbol">:global</span>, <span class="constant">__MODULE__&#125;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>([]) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, [], <span class="number">1000</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handle_info</span></span>(<span class="symbol">:timeout</span>, state) <span class="keyword">do</span></span><br><span class="line">    <span class="constant">Logger.</span>debug <span class="string">"timeout"</span></span><br><span class="line">    &#123;<span class="symbol">:noreply</span>, state, <span class="number">1000</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mix compile</span><br></pre></td></tr></table></figure>
<h2 id="应用程序分布">应用程序分布</h2><p>本节阐述了如何把一个应用程序分布到多个节点上</p>
<p>假设应用程序运行在3个节点上, 名称分别为<code>abc</code>, <code>bcd</code>, <code>def</code>. 创建三个配置文件如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch config/abc.config&#10;touch config/bcd.config&#10;touch config/def.config</span><br></pre></td></tr></table></figure>
<p>配置文件中有3个重要的键值对. <code>distributed</code>, <code>sync_nodes_mandatory</code> 和 <code>sync_nodes_timeout</code>, 其中:</p>
<ol>
<li><code>distributed</code> 定义了分布式应用的启动延迟, 备用节点.</li>
<li><code>sync_nodes_mandatory</code> 定义强制要求的节点</li>
<li><code>sync_nodes_timeout</code> 定义了<code>distributed</code>中所有节点都启动完成需要等待的时间, 如果在此时间内要求的节点没有全部启动, 那么所有节点上的应用启动失败.</li>
</ol>
<p>abc.config</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#10;  &#123;logger,[&#123;console,[&#123;format,&#60;&#60;&#34;$date $time $metadata[$level] $message\n&#34;&#62;&#62;&#125;]&#125;]&#125;,&#10;  &#123;kernel,&#10;    [&#123;distributed, [&#10;        &#123;&#39;distro&#39;, 5000, [&#39;abc@192.168.8.104&#39;, &#123;&#39;bcd@192.168.8.104&#39;, &#39;def@192.168.8.104&#39;&#125;]&#125;]&#125;,&#10;        &#123;sync_nodes_mandatory, [&#39;bcd@192.168.8.104&#39;, &#39;def@192.168.8.104&#39;]&#125;,&#10;        &#123;sync_nodes_timeout, 30000&#125;&#10;]&#125;].</span><br></pre></td></tr></table></figure>
<p>bcd.config</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#10;  &#123;logger,[&#123;console,[&#123;format,&#60;&#60;&#34;$date $time $metadata[$level] $message\n&#34;&#62;&#62;&#125;]&#125;]&#125;,&#10;  &#123;kernel,&#10;    [&#123;distributed, [&#10;        &#123;distro,5000, [&#39;abc@192.168.8.104&#39;, &#123;&#39;bcd@192.168.8.104&#39;, &#39;def@192.168.8.104&#39;&#125;]&#125;]&#125;,&#10;        &#123;sync_nodes_mandatory, [&#39;abc@192.168.8.104&#39;, &#39;def@192.168.8.104&#39;]&#125;,&#10;        &#123;sync_nodes_timeout, 30000&#125;&#10;]&#125;].</span><br></pre></td></tr></table></figure>
<p>def.config</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#10;  &#123;logger,[&#123;console,[&#123;format,&#60;&#60;&#34;$date $time $metadata[$level] $message\n&#34;&#62;&#62;&#125;]&#125;]&#125;,&#10;  &#123;kernel,&#10;    [&#123;distributed, [&#10;        &#123;distro,5000, [&#39;abc@192.168.8.104&#39;, &#123;&#39;bcd@192.168.8.104&#39;, &#39;def@192.168.8.104&#39;&#125;]&#125;]&#125;,&#10;        &#123;sync_nodes_mandatory, [&#39;abc@192.168.8.104&#39;, &#39;bcd@192.168.8.104&#39;]&#125;,&#10;        &#123;sync_nodes_timeout, 30000&#125;&#10;]&#125;].</span><br></pre></td></tr></table></figure>
<p>在不同的终端自动全部3个节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iex --name abc@192.168.8.104 -pa _build/dev/lib/distro/ebin/ --app distro \&#10;--erl &#34;-config config/abc&#34;&#10;&#10;iex --name bcd@192.168.8.104 -pa _build/dev/lib/distro/ebin/ --app distro \&#10;--erl &#34;-config config/bcd&#34;&#10;&#10;iex --name def@192.168.8.104 -pa _build/dev/lib/distro/ebin/ --app distro \&#10;--erl &#34;-config config/def&#34;</span><br></pre></td></tr></table></figure>
<h2 id="验证步骤">验证步骤</h2><p>bcd, def 是 abc 的备用节点. bcd 优先于def, 如果abc死掉, 应用程序会在bcd上重启, 如果bcd死掉, 应用程序会转移到def, 这时候abc, bcd 修复启动后, 应用会被abc接管.</p>
<ol>
<li>终止(Ctrl+C两次)节点abc@192.168.8.104后,5秒内会在节点bcd@192.168.8.104上重启应用</li>
<li>再次启动节点abc@192.168.8.104后,应用在bcd@192.168.8.104上停止, 应用被恢复后的abc@192.168.8.104节点接管(Takeover)</li>
</ol>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="https://erlangcentral.org/topic/elixir-application-failovertakeover" target="_blank" rel="external">Elixir Application Failover/Takeover</a></li>
<li><a href="http://learnyousomeerlang.com/distributed-otp-applications" target="_blank" rel="external">Distributed OTP Applications</a></li>
<li><a href="https://github.com/developerworks/distro" target="_blank" rel="external">源码仓库</a> (<strong>求加星</strong>)</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-09-17T01:15:34.000Z"><a href="/2015/09/17/ejabberd-with-elixir-mix/">2015-09-17</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/17/ejabberd-with-elixir-mix/">用Elixir Mix构建Ejabberd发行包</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>Github上Ejabberd最新版15.07支持通过Elixir Mix构建工具创建Ejabberd的发行(部署)包.</p>
<p>详细信息参考这篇BLog: <a href="https://blog.process-one.net/building-an-otp-release-for-ejabberd-with-elixir-mix/" target="_blank" rel="external">https://blog.process-one.net/building-an-otp-release-for-ejabberd-with-elixir-mix/</a></p>
<p>其使用了Elixir的<code>exrm</code>打包工具</p>
<h1 id="构建过程和步骤">构建过程和步骤</h1><h2 id="1-_创建目录和克隆仓库">1. 创建目录和克隆仓库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir ejabberd-demo1&#10;mkdir ejabberd-demo1/deploy&#10;cd ejabberd-demo1&#10;git clone https://github.com/processone/ejabberd.git</span><br></pre></td></tr></table></figure>
<h2 id="2-_编译">2. 编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ejabberd-demo1/ejabberd&#10;mix do deps.get, compile</span><br></pre></td></tr></table></figure>
<h2 id="3-_创建发布包">3. 创建发布包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIX_ENV=prod mix release</span><br></pre></td></tr></table></figure>
<h2 id="4-_部署">4. 部署</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p deploy/ejabberd&#10;tar zxvf rel/ejabberd/releases/15.07.0/ejabberd.tar.gz  -C deploy/ejabberd</span><br></pre></td></tr></table></figure>
<h2 id="5-_创建配置文件">5. 创建配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir deploy/ejabberd/config&#10;cd deploy/ejabberd/config&#10;wget https://gist.githubusercontent.com/mremond/383666d563025e86adfe/raw/723dfa50c955c112777f3361b4f2067b76a55d7b/ejabberd.yml</span><br></pre></td></tr></table></figure>
<h2 id="6-_启动">6. 启动</h2><p>前台运行(调试)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deploy/ejabberd/bin/ejabberd console</span><br></pre></td></tr></table></figure>
<p>后台运行(产品环境)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deploy/ejabberd/bin/ejabberd start</span><br></pre></td></tr></table></figure>
<h2 id="7-_注册一个测试用户">7. 注册一个测试用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:ejabberd_auth.try_register(&#34;user1&#34;, &#34;localhost&#34;, &#34;mypass&#34;)</span><br></pre></td></tr></table></figure>
<h2 id="8-_停止Ejabberd">8. 停止Ejabberd</h2><p>调试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:init.stop()</span><br></pre></td></tr></table></figure>
<h1 id="热代码替换步骤">热代码替换步骤</h1><p>假定在15.07.0中发现了一个BUG, 修改该BUG后, 更新线上系统.</p>
<h2 id="1-_修改Ejabberd源码">1. 修改Ejabberd源码</h2><p>比如修改一个线上的程序BUG</p>
<h2 id="2-_修改Mix项目文件">2. 修改Mix项目文件</h2><p>修改Ejabberd源码根目录下的<code>mix.exs</code>文件, 提升版本号</p>
<h2 id="3-_编译">3. 编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix compile</span><br></pre></td></tr></table></figure>
<h2 id="4-_重新生产新的发行包">4. 重新生产新的发行包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIX_ENV=prod mix release</span><br></pre></td></tr></table></figure>
<h2 id="5-_实时升级线上系统">5. 实时升级线上系统</h2><ul>
<li>创建一个新目录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p deploy/ejabberd/releases/15.07.1</span><br></pre></td></tr></table></figure>
<ul>
<li>创建新发行文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf rel/ejabberd/releases/15.07.1/ejabberd.tar.gz  -C deploy/ejabberd</span><br></pre></td></tr></table></figure>
<ul>
<li>执行升级</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deploy/ejabberd/bin/ejabberd upgrade &#34;15.07.1&#34;</span><br></pre></td></tr></table></figure>
<h2 id="结语">结语</h2><p>上述只是一个基本过程, 实际项目往往比这个过程复杂, 这个简单的过程只是说明如何使用.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-06-05T08:29:29.000Z"><a href="/2015/06/05/uftp/">2015-06-05</a></time>
      
      
  
    <h1 class="title"><a href="/2015/06/05/uftp/">UFTP - 基于UDP的加密文件多播传输协议</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>UFTP - Encrypted UDP based FTP with multicast</p>
<h2 id="应用场景">应用场景</h2><ul>
<li>软件包分发</li>
<li>视频流分发</li>
</ul>
<h2 id="下载和编译">下载和编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://sourceforge.net/projects/uftp-multicast/files/source-tar/uftp-4.7.tar&#10;tar xf uftp-4.7.tar&#10;cd uftp-4.7&#10;make&#10;make install</span><br></pre></td></tr></table></figure>
<h2 id="测试和使用">测试和使用</h2><p>查看manpage</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man uftpd&#10;man uftp</span><br></pre></td></tr></table></figure>
<p>uftpd是客户端守护进程, 用于一直监听服务端发送的多播包<br>uftp是服务端, 用于发送文件</p>
<p>客户端监听在本地接口en0的50002端口上, 并接受多播地址为224.0.0.100的多播包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./uftpd -d -I en0 -D /tmp/uftp/done -T /tmp/uftp/receiving -M 224.0.0.100</span><br></pre></td></tr></table></figure>
<p>服务器端发送文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./uftp -R 500 -p 50002 -I en0 -x 5 -M 224.0.0.100 -P 224.0.0.100 ../update.zip</span><br></pre></td></tr></table></figure>
<h2 id="常用命令行选项解释">常用命令行选项解释</h2><p><img src="/assets/uftp.jpg" alt="UFTP命令行参数"></p>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="http://en.wikipedia.org/wiki/UFTP" target="_blank" rel="external">http://en.wikipedia.org/wiki/UFTP</a></li>
<li><a href="http://uftp-multicast.sourceforge.net" target="_blank" rel="external">http://uftp-multicast.sourceforge.net</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-06-04T09:02:49.000Z"><a href="/2015/06/04/html5-web-cryptography-api-hashing/">2015-06-04</a></time>
      
      
  
    <h1 class="title"><a href="/2015/06/04/html5-web-cryptography-api-hashing/">Web加密API - 散列(Hashing)</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>本文说明了如何使用Web加密API生成数据的HASH值.</p>
<h2 id="转换字符串为ArrayBuffer,并且把ArrayBuffer转换为16进制字符串">转换字符串为ArrayBuffer,并且把ArrayBuffer转换为16进制字符串</h2><p>要生成字符串文本或二进制数据的Hash值, 必须先把它转换为ArrayBuffer类型.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertStringToArrayBufferView</span>(<span class="params">str</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bytes = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(str.length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> iii = <span class="number">0</span>; iii &lt; str.length; iii++)</span><br><span class="line">    &#123;</span><br><span class="line">        bytes[iii] = str.charCodeAt(iii);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertArrayBufferToHexaDecimal</span>(<span class="params">buffer</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data_view = <span class="keyword">new</span> <span class="built_in">DataView</span>(buffer)</span><br><span class="line">    <span class="keyword">var</span> iii, len, hex = <span class="string">''</span>, c;</span><br><span class="line">    <span class="keyword">for</span>(iii = <span class="number">0</span>, len = data_view.byteLength; iii &lt; len; iii += <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        c = data_view.getUint8(iii).toString(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span>(c.length &lt; <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            c = <span class="string">'0'</span> + c;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hex += c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="生成字符串的HASH值">生成字符串的HASH值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var data = &#34;QNimate&#34;;&#10;&#10;var crypto = window.crypto || window.msCrypto;&#10;&#10;if(crypto.subtle)&#10;&#123;&#10;    alert(&#34;Cryptography API Supported&#34;);&#10;&#10;    var promise = crypto.subtle.digest(&#123;name: &#34;SHA-256&#34;&#125;, convertStringToArrayBufferView(data));&#10;&#10;    promise.then(function(result)&#123;&#10;        var hash_value = convertArrayBufferToHexaDecimal(result);&#10;    &#125;);&#10;&#125;&#10;else&#10;&#123;&#10;    alert(&#34;Cryptography API not Supported&#34;);&#10;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="http://qnimate.com/hashing-using-web-cryptography-api/" target="_blank" rel="external">http://qnimate.com/hashing-using-web-cryptography-api/</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-06-04T04:58:54.000Z"><a href="/2015/06/04/the-3-modes-of-http-protocol/">2015-06-04</a></time>
      
      
  
    <h1 class="title"><a href="/2015/06/04/the-3-modes-of-http-protocol/">HTTP协议的三种模式</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="CLOSE">CLOSE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#36830;&#25509;1] [&#35831;&#27714;1] ... [&#21709;&#24212;1] [&#20851;&#38381;1] [&#36830;&#25509;2] [&#35831;&#27714;2] ... [&#21709;&#24212;2] [&#20851;&#38381;2] ...</span><br></pre></td></tr></table></figure>
<p>特点:<br>没一个请求都要建立新的连接, 请求完毕关闭连接</p>
<h2 id="KEEP-ALIVE">KEEP-ALIVE</h2><p><code>KEEP-ALIVE</code>模式是为了解决<code>CLOSE</code>模式频繁建立和关闭连接开销的问题. 它在一个连接中可以执行多次请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#36830;&#25509;] [&#35831;&#27714;1] ... [&#21709;&#24212;1] [&#35831;&#27714;2] ... [&#21709;&#24212;2] [&#20851;&#38381;] ...</span><br></pre></td></tr></table></figure>
<p>特点:</p>
<p>请求是串行的, 当前请求只有在客户端收到响应后才能执行下一次请求, 它是事务性的.</p>
<h2 id="PIPELINING">PIPELINING</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#36830;&#25509;] [&#35831;&#27714;1] [&#35831;&#27714;2]... [&#21709;&#24212;1][&#21709;&#24212;2] [&#20851;&#38381;] ...</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-05-21T13:21:04.000Z"><a href="/2015/05/21/ejabberd-with-elixir-packet-filters/">2015-05-21</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/21/ejabberd-with-elixir-packet-filters/">Ejabberd 用Elixir开发一个包过滤模块</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>过滤模块主要用于</p>
<h2 id="创建一个模块骨架">创建一个模块骨架</h2><p>在Ejabberd源码根目录下的<code>lib</code>目录中创建 <code>filter_packet_demo.ex</code>模块文件, 代码如下:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">FilterPacketDemo</span></span> <span class="keyword">do</span></span><br><span class="line">  import <span class="constant">Ejabberd.Logger</span></span><br><span class="line">  <span class="variable">@behaviour</span> <span class="symbol">:gen_mod</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start</span></span>(<span class="constant">_host,</span> <span class="constant">_opts)</span> <span class="keyword">do</span></span><br><span class="line">    info(<span class="string">'Starting ejabberd module Filter Packet Demo'</span>)</span><br><span class="line">    <span class="constant">Ejabberd.Hooks.</span>add(<span class="symbol">:filter_packet</span>, <span class="symbol">:global</span>, <span class="constant">__ENV__.</span><span class="keyword">module</span>, <span class="symbol">:on_filter_packet</span>, <span class="number">50</span>)</span><br><span class="line">    <span class="symbol">:ok</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">stop</span></span>(<span class="constant">_host)</span> <span class="keyword">do</span></span><br><span class="line">    info(<span class="string">'Stopping ejabberd module Filter Packet Demo'</span>)</span><br><span class="line">    <span class="constant">Ejabberd.Hooks.</span>delete(<span class="symbol">:filter_packet</span>, <span class="symbol">:global</span>, <span class="constant">__ENV__.</span><span class="keyword">module</span>, <span class="symbol">:on_filter_packet</span>, <span class="number">50</span>)</span><br><span class="line">    <span class="symbol">:ok</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">on_filter_packet</span></span>(&#123;from, to, xml=&#123;<span class="symbol">:xmlel</span>, <span class="string">"message"</span>, attributes, children&#125;&#125; = packet) <span class="keyword">do</span></span><br><span class="line">    info(<span class="string">"Filtering packet: <span class="subst">#&#123;inspect &#123;from, to, xml&#125;</span>&#125;"</span>)</span><br><span class="line">    <span class="comment"># 访问XML元素属性</span></span><br><span class="line">    <span class="comment"># attributes 是一个形如 [&#123;"type", "chat"&#125;, ...]的元组列表, 为了方便访问, 使用如下函数转换为关键字列表</span></span><br><span class="line">    convert = <span class="keyword">fn</span> &#123;k,v&#125; -&gt;</span><br><span class="line">        &#123;<span class="constant">String.</span>to_atom(k), v&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    attribute_keywords = attributes |&gt; <span class="constant">Enum.</span>map convert</span><br><span class="line">    type = attribute_keywords[<span class="symbol">:type</span>]</span><br><span class="line">    <span class="keyword">cond</span> <span class="keyword">do</span></span><br><span class="line">        type == <span class="string">"chat"</span> -&gt;</span><br><span class="line">            dosomething()</span><br><span class="line">        type == <span class="string">"headline"</span> -&gt;</span><br><span class="line">            dosomething()</span><br><span class="line">        type == <span class="string">"groupchat"</span> -&gt;</span><br><span class="line">            dosomething()</span><br><span class="line">        <span class="keyword">true</span> -&gt;</span><br><span class="line">            <span class="keyword">true</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    packet</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dosomething</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="constant">IO.</span>puts <span class="string">"Do something."</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="编译,安装,动态更新">编译,安装,动态更新</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#32534;&#35793;&#10;make&#10;make install</span><br></pre></td></tr></table></figure>
<h1 id="启动">启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ejabberdctl live</span><br></pre></td></tr></table></figure>
<h1 id="进入调试控制台">进入调试控制台</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ejabberdctl debug</span><br></pre></td></tr></table></figure>
<h1 id="在调试控制台中运行">在调试控制台中运行</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ejabberd@localhost)1&#62; ejabberd_update:update().&#10;&#123;ok,[]&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li>Elixir Sips: ejabberd with Elixir – Part 2<br><a href="https://blog.process-one.net/ejabberd-with-elixir-packet-filters/" target="_blank" rel="external">https://blog.process-one.net/ejabberd-with-elixir-packet-filters/</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-05-18T09:28:10.000Z"><a href="/2015/05/18/chrome-dev-get-started/">2015-05-18</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/18/chrome-dev-get-started/">Chrome 开发入门</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="安装">安装</h2><ul>
<li>从 <a href="">Chrome Dev Editor</a> 安装该编辑器</li>
<li>从应用启动器或<code>chrome://apps</code>打开Chrome Dev Editor</li>
</ul>
<h2 id="Chrome_Dev_Editor功能">Chrome Dev Editor功能</h2><ul>
<li>Chrome Apps</li>
</ul>
<h2 id="参考资料">参考资料</h2><ol>
<li>Chrome Dev Editor 入门<br><a href="https://github.com/GoogleChrome/chromedeveditor/blob/master/doc/GettingStarted.md" target="_blank" rel="external">https://github.com/GoogleChrome/chromedeveditor/blob/master/doc/GettingStarted.md</a></li>
<li>图书 [Programming Chrome Apps] 第6页 [Using the Chrome Dev Editor]</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-05-18T05:07:13.000Z"><a href="/2015/05/18/html5-web-cryptography-api-tutorial/">2015-05-18</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/18/html5-web-cryptography-api-tutorial/">Web加密API指南</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>Web加密API提供了执行像散列, 对称 &amp; 非对称加密, 生成 &amp; 校验数字签名等操作的Javascript接口.</p>
<p>本文将介绍加密基础和<a href="http://www.w3.org/TR/WebCryptoAPI" target="_blank" rel="external">Web Cryptography API</a></p>
<p>使用Web Cryptography API需要浏览器的支持, 目前集中常用浏览器的支持情况是:</p>
<ul>
<li>Microsoft Edge</li>
<li>Google Chrome 37+</li>
<li>Mozilla Firefox 37+</li>
<li>Apple Safari 8+</li>
<li>Opera 27+</li>
</ul>
<p>其他浏览器可参考参考资料2</p>
<h2 id="使用Web加密API">使用Web加密API</h2><h3 id="安全源策略(Secure_Origin_Policy)">安全源策略(Secure Origin Policy)</h3><p>当且仅当Javascript运行在一个安全源Web页面时, 可访问Web加密API.</p>
<p>“安全源” 是至少匹配如下模式的来源:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(https, *, *)&#10;(wss, *, *)&#10;(*, localhost, *)&#10;(*, 127/8, *)&#10;(*, ::1/128, *)&#10;(file, *, &#8212;)</span><br></pre></td></tr></table></figure>
<h3 id="支持的加密算法">支持的加密算法</h3><p>##</p>
<h2 id="参考资料">参考资料</h2><ol>
<li><p>W3C Web Cryptography API 规范<br><a href="http://www.w3.org/TR/WebCryptoAPI/" target="_blank" rel="external">http://www.w3.org/TR/WebCryptoAPI/</a></p>
</li>
<li><p>浏览器支持情况<br><a href="http://caniuse.com/#feat=cryptography" target="_blank" rel="external">http://caniuse.com/#feat=cryptography</a></p>
</li>
<li><p><a href="http://qnimate.com/post-series/web-cryptography-api-tutorial/" target="_blank" rel="external">http://qnimate.com/post-series/web-cryptography-api-tutorial/</a></p>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-05-17T10:00:35.000Z"><a href="/2015/05/17/html5-battery-status/">2015-05-17</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/17/html5-battery-status/">HTML5获取电池状态</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>W3C电池状态接口定义</p>
<p><img src="/assets/html5/battery-status.png" alt="电池状态接口"></p>
<p>示例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">title</span>&gt;</span>电池状态API示例<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">updateBatteryStatus</span>(<span class="params">battery</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">'#charging'</span>).textContent = battery.charging ? <span class="string">'正在使用交流电'</span> : <span class="string">'正在使用电池'</span>;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">'#level'</span>).textContent = battery.level;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">'#dischargingTime'</span>).textContent = battery.dischargingTime / <span class="number">60</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      navigator.getBattery().then(<span class="function"><span class="keyword">function</span> (<span class="params">battery</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Update the battery status initially when the promise resolves ...</span></span><br><span class="line">        updateBatteryStatus(battery);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// .. and for any subsequent updates.</span></span><br><span class="line">        battery.onchargingchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          updateBatteryStatus(battery);</span><br><span class="line">        &#125;;</span><br><span class="line">        battery.onlevelchange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          updateBatteryStatus(battery);</span><br><span class="line">        &#125;;</span><br><span class="line">        battery.ondischargingtimechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          updateBatteryStatus(battery);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"charging"</span>&gt;</span>(charging state unknown)<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"level"</span>&gt;</span>(battery level unknown)<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"dischargingTime"</span>&gt;</span>(discharging time unknown)<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li><p>电池状态W3C规范<br><a href="http://www.w3.org/TR/battery-status/" target="_blank" rel="external">http://www.w3.org/TR/battery-status/</a></p>
</li>
<li><p>新的 JavaScript Battery API<br><a href="http://cssha.com/battery/" target="_blank" rel="external">http://cssha.com/battery/</a></p>
</li>
<li><p>BatteryManager<br><a href="https://developer.mozilla.org/en-US/docs/Web/API/BatteryManager" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/API/BatteryManager</a></p>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-05-10T11:49:56.000Z"><a href="/2015/05/10/ejabberd-mam-module-how-to-use/">2015-05-10</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/10/ejabberd-mam-module-how-to-use/">如何使用Ejabberd消息归档模块</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>这篇文章阐述了如何使用Ejabberd提供的第三方消息归档模块</p>
<h2 id="前置阅读">前置阅读</h2><p>15.03在加载外部模块时有个BUG:<br><a href="https://github.com/processone/ejabberd/commit/8b23727cc6db571b9d1dcc6119e39a602fe37279" target="_blank" rel="external">https://github.com/processone/ejabberd/commit/8b23727cc6db571b9d1dcc6119e39a602fe37279</a></p>
<p>所以, 请使用最新的15.04版本的Ejabberd</p>
<p>继续下面的步骤之前, 请先阅读<a href="http://developerworks.github.io/2015/03/17/ejabberd-easy-installer-and-structure-for-ejabberd-contributed-modules/">如何安装模块</a></p>
<h2 id="安装模块">安装模块</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ejabberdctl modules_update_specs&#10;ejabberdctl modules_available&#10;ejabberdctl module_install mod_mam</span><br></pre></td></tr></table></figure>
<h2 id="重新编译">重新编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<h2 id="修改配置文件">修改配置文件</h2><p>配置文件有两个地方需要修改</p>
<ul>
<li>增加<code>mod_mam</code>模块配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mod_mam:&#10;  access_max_user_messages: access_max_user_messages&#10;  default_page_size: 25&#10;  max_page_size: 100&#10;  request_activates_archiving: true&#10;  iqdisc: parallel</span><br></pre></td></tr></table></figure>
<p>配置说明,请参考模块的<a href="https://github.com/processone/ejabberd-contrib/tree/master/mod_mam" target="_blank" rel="external">README</a>文件</p>
<ul>
<li>修改<code>mod_roster: {}</code> 为</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mod_roster:&#10;  versioning: true</span><br></pre></td></tr></table></figure>
<p>最后, 重启Ejabberd服务器</p>
<h2 id="服务功能查询">服务功能查询</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">## IQ-get 请求</span><br><span class="line"><span class="tag">&lt;<span class="title">iq</span> <span class="attribute">type</span>=<span class="value">'get'</span></span><br><span class="line">    <span class="attribute">id</span>=<span class="value">'id-1431259882548'</span></span><br><span class="line">    <span class="attribute">to</span>=<span class="value">'x.hezhiqiang.info'</span></span><br><span class="line">    <span class="attribute">from</span>=<span class="value">'root@x.hezhiqiang.info'</span></span><br><span class="line">    <span class="attribute">xml:lang</span>=<span class="value">'zh'</span></span><br><span class="line">    <span class="attribute">xmlns</span>=<span class="value">'jabber:client'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">query</span> <span class="attribute">xmlns</span>=<span class="value">'http://jabber.org/protocol/disco#info'</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">iq</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># IQ-result 响应</span><br><span class="line"><span class="tag">&lt;<span class="title">iq</span> <span class="attribute">from</span>=<span class="value">'x.hezhiqiang.info'</span></span><br><span class="line">    <span class="attribute">to</span>=<span class="value">'root@x.hezhiqiang.info/24790037601431259873977465'</span></span><br><span class="line">    <span class="attribute">id</span>=<span class="value">'id-1431259882548'</span></span><br><span class="line">    <span class="attribute">type</span>=<span class="value">'result'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">query</span> <span class="attribute">xmlns</span>=<span class="value">'http://jabber.org/protocol/disco#info'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">identity</span> <span class="attribute">category</span>=<span class="value">'pubsub'</span> <span class="attribute">type</span>=<span class="value">'pep'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">identity</span> <span class="attribute">category</span>=<span class="value">'server'</span> <span class="attribute">type</span>=<span class="value">'im'</span> <span class="attribute">name</span>=<span class="value">'ejabberd'</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">x</span> <span class="attribute">xmlns</span>=<span class="value">'jabber:x:data'</span> <span class="attribute">type</span>=<span class="value">'result'</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">field</span> <span class="attribute">var</span>=<span class="value">'FORM_TYPE'</span> <span class="attribute">type</span>=<span class="value">'hidden'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>http://jabber.org/network/serverinfo<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">x</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="title">feature</span> <span class="attribute">var</span>=<span class="value">'urn:xmpp:mam:0'</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="title">query</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">iq</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>你会看到, 多了一个<code>&lt;feature var=&#39;urn:xmpp:mam:0&#39;/&gt;</code></p>
<p>注意: 目前MAM模块暂时支持Mnesia数据库作为后端存储</p>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="http://www.lebsanft.org/?p=537" target="_blank" rel="external">http://www.lebsanft.org/?p=537</a></li>
<li><a href="https://github.com/processone/ejabberd-contrib/tree/master/mod_mam" target="_blank" rel="external">https://github.com/processone/ejabberd-contrib/tree/master/mod_mam</a></li>
<li><a href="http://xmpp.org/extensions/xep-0279.html" target="_blank" rel="external">http://xmpp.org/extensions/xep-0279.html</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-05-07T04:53:31.000Z"><a href="/2015/05/07/xmpp-xep-0279-server-ip-check/">2015-05-07</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/07/xmpp-xep-0279-server-ip-check/">服务器IP检查</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>该规范定义了一个XMPP扩展, 让客户端能够发现其自己的外部IP地址.</p>
<p>Ejabberd实现模块: <code>mod_sic</code></p>
<p>首先客户端发送一个<code>IQ-get</code>给服务器:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iq type=&#39;get&#39;&#10;    from=&#39;root@x.hezhiqiang.info&#39;&#10;    id=&#39;id-1431053085377&#39;&#10;    xmlns=&#39;jabber:client&#39;&#62;&#10;  &#60;address xmlns=&#39;urn:xmpp:sic:0&#39;/&#62;&#10;&#60;/iq&#62;</span><br></pre></td></tr></table></figure>
<p>服务器端响应一个<code>IQ-result</code>XML片段, 包含一个<code>&lt;address&gt;</code>元素, 其中包含客户端的外部IP地址<code>&lt;ip&gt;</code>, 以及一个可选的<code>&lt;port&gt;</code>元素表示客户端外部IP所对应的端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;iq from=&#39;root@x.hezhiqiang.info&#39;&#10;    to=&#39;root@x.hezhiqiang.info/1964144757143129898889436&#39;&#10;    id=&#39;id-1431053085377&#39;&#10;    type=&#39;result&#39;&#62;&#10;  &#60;address xmlns=&#39;urn:xmpp:sic:0&#39;&#62;192.168.8.104&#60;/address&#62;&#10;&#60;/iq&#62;</span><br></pre></td></tr></table></figure>
<p>判断XMPP服务器是否支持该协议扩展</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;!--&#35831;&#27714;--&#62;&#10;&#60;iq type=&#39;get&#39; id=&#39;id-1431052837499&#39;&#10;    to=&#39;x.hezhiqiang.info&#39;&#10;    from=&#39;root@x.hezhiqiang.info&#39;&#10;    xml:lang=&#39;zh&#39;&#10;    xmlns=&#39;jabber:client&#39;&#62;&#10;  &#60;query xmlns=&#39;http://jabber.org/protocol/disco#info&#39;/&#62;&#10;&#60;/iq&#62;&#10;&#60;!--&#21709;&#24212;--&#62;&#10;&#60;iq from=&#39;x.hezhiqiang.info&#39;&#10;    to=&#39;root@x.hezhiqiang.info/1964144757143129898889436&#39;&#10;    id=&#39;id-1431052837499&#39;&#10;    type=&#39;result&#39;&#62;&#10;  &#60;query xmlns=&#39;http://jabber.org/protocol/disco#info&#39;&#62;&#10;    &#60;identity category=&#39;pubsub&#39; type=&#39;pep&#39;/&#62;&#10;    &#60;identity category=&#39;server&#39; type=&#39;im&#39; name=&#39;ejabberd&#39;/&#62;&#10;    &#60;x xmlns=&#39;jabber:x:data&#39; type=&#39;result&#39;&#62;&#10;      &#60;field var=&#39;FORM_TYPE&#39; type=&#39;hidden&#39;&#62;&#10;        &#60;value&#62;http://jabber.org/network/serverinfo&#60;/value&#62;&#10;      &#60;/field&#62;&#10;    &#60;/x&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/commands&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/disco#info&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/disco#items&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#access-authorize&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#access-open&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#access-presence&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#access-whitelist&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#auto-create&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#auto-subscribe&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#collections&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#config-node&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#create-and-configure&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#create-nodes&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#delete-items&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#delete-nodes&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#filtered-notifications&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#get-pending&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#instant-nodes&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#item-ids&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#last-published&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#manage-subscriptions&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#member-affiliation&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#modify-affiliations&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#multi-subscribe&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#outcast-affiliation&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#persistent-items&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#presence-notifications&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#presence-subscribe&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#publish&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#publish-only-affiliation&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#publisher-affiliation&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#purge-nodes&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#retract-items&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#retrieve-affiliations&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#retrieve-default&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#retrieve-items&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#retrieve-subscriptions&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#shim&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#subscribe&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#subscription-notifications&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/pubsub#subscription-options&#39;/&#62;&#10;    &#60;feature var=&#39;http://jabber.org/protocol/stats&#39;/&#62;&#10;    &#60;feature var=&#39;iq&#39;/&#62;&#10;    &#60;feature var=&#39;jabber:iq:last&#39;/&#62;&#10;    &#60;feature var=&#39;jabber:iq:privacy&#39;/&#62;&#10;    &#60;feature var=&#39;jabber:iq:private&#39;/&#62;&#10;    &#60;feature var=&#39;jabber:iq:register&#39;/&#62;&#10;    &#60;feature var=&#39;jabber:iq:roster&#39;/&#62;&#10;    &#60;feature var=&#39;jabber:iq:time&#39;/&#62;&#10;    &#60;feature var=&#39;jabber:iq:version&#39;/&#62;&#10;    &#60;feature var=&#39;msgoffline&#39;/&#62;&#10;    &#60;feature var=&#39;presence&#39;/&#62;&#10;    &#60;feature var=&#39;urn:xmpp:blocking&#39;/&#62;&#10;    &#60;feature var=&#39;urn:xmpp:carbons:1&#39;/&#62;&#10;    &#60;feature var=&#39;urn:xmpp:carbons:2&#39;/&#62;&#10;    &#60;feature var=&#39;urn:xmpp:ping&#39;/&#62;&#10;    &#60;feature var=&#39;urn:xmpp:sic:0&#39;/&#62;&#10;    &#60;feature var=&#39;urn:xmpp:time&#39;/&#62;&#10;    &#60;feature var=&#39;vcard-temp&#39;/&#62;&#10;  &#60;/query&#62;&#10;&#60;/iq&#62;</span><br></pre></td></tr></table></figure>
<p>上述结果<code>79</code>行包含一个<code>&lt;feature var=&#39;urn:xmpp:sic:0&#39;/&gt;</code>, 表示服务器支持该协议扩展, 我们需要解析上述服务器响应来判断是否包含<code>&lt;feature var=&#39;urn:xmpp:sic:0&#39;/&gt;</code>元素,如果包含标识服务器支持. 否则不支持.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-23T05:08:39.000Z"><a href="/2015/03/23/thrift-messing-guide/">2015-03-23</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/23/thrift-messing-guide/">Thrift: The Missing Guide</a></h1>
  

    </header>
    <div class="entry">
      


        


        <blockquote>
<p>Thrift is a software framework for scalable cross-language services development. It combines a software stack with a code generation engine to build services that work efficiently and seamlessly between C++, Java, Python, PHP, Ruby, Erlang, Perl, Haskell, C#, Cocoa, JavaScript, Node.js, Smalltalk, and OCaml.</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-18T12:06:46.000Z"><a href="/2015/03/18/ejabberd-os-optimizations/">2015-03-18</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/18/ejabberd-os-optimizations/">针对Ejabberd的操作系统C1000K优化</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>本文基于Ubuntu Server 14.04进行优化, 不同的Linux/Unix系统有不同的细节.</p>
<p>查看系统当前支持的最大打开文件数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ci:~# cat /proc/sys/fs/nr_open&#10;1048576</span><br></pre></td></tr></table></figure>
<p>查看硬性限制和软性限制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -Hn&#10;ulimit -Sn</span><br></pre></td></tr></table></figure>
<p>如果该值小于1000K, 请增大如下设置, 否则达不到100W并发连接.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.file-max = 1024000&#10;net.ipv4.ip_conntrack_max = 1024000&#10;net.ipv4.netfilter.ip_conntrack_max = 1024000</span><br></pre></td></tr></table></figure>
<p>所有进程打开的文件描述符数不能超过<code>/proc/sys/fs/file-max</code><br>单个进程打开的文件描述符数不能超过user limit中nofile的soft limit<br>nofile的soft limit不能超过其hard limit<br>nofile的hard limit不能超过<code>/proc/sys/fs/nr_open</code></p>
<p>查看服务器TCP状态:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -n | awk &#39;/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;&#39;</span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="http://www.ideawu.net/blog/archives/740.html" target="_blank" rel="external">构建C1000K的服务器(1) – 基础</a></li>
<li><a href="http://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files" target="_blank" rel="external">Linux Increase The Maximum Number Of Open Files / File Descriptors (FD)</a></li>
<li><a href="http://lansgg.blog.51cto.com/5675165/1576200" target="_blank" rel="external">Linux系统优化加固</a></li>
</ol>
<p>fs.file-max=65535000</p>
<p>net.nf_conntrack_max = 1000000</p>
<p>net.core.rmem_max = 16777216<br>net.core.wmem_max = 16777216</p>
<p>net.core.netdev_max_backlog = 3000000</p>
<p>net.ipv4.tcp_tw_recycle = 0<br>net.ipv4.tcp_tw_reuse = 1<br>net.ipv4.tcp_timestamps = 1<br>net.ipv4.tcp_max_syn_backlog = 65535<br>net.ipv4.tcp_fin_timeout = 30<br>net.ipv4.tcp_keepalive_time = 1800<br>net.ipv4.tcp_rmem = 4096 4096 16777216<br>net.ipv4.tcp_wmem = 4096 4096 16777216</p>
<p>net.ipv4.ip_local_port_range = 1024 65000<br>net.ipv4.tcp_rmem = 4096 87380 16777216<br>net.ipv4.tcp_wmem = 4096 65536 16777216</p>
<p>#net.ipv4.tcp_congestion_control = HTCP</p>
<p>#net.ipv4.tcp_mtu_probing = 1</p>
<p>net.netfilter.nf_conntrack_max = 1000000<br>net.netfilter.nf_conntrack_buckets = 32768</p>
<p>#net.netfilter.nf_conntrack_tcp_timeout_established = 432000<br>net.netfilter.nf_conntrack_tcp_timeout_established = 3600<br>net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120<br>net.netfilter.nf_conntrack_tcp_timeout_close_wait = 60<br>net.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120</p>
<p>解决 nf_conntrack: table full, dropping packet 的几种思路<br><a href="http://jaseywang.me/2012/08/16/%E8%A7%A3%E5%86%B3-nf_conntrack-table-full-dropping-packet-%E7%9A%84%E5%87%A0%E7%A7%8D%E6%80%9D%E8%B7%AF/" target="_blank" rel="external">http://jaseywang.me/2012/08/16/%E8%A7%A3%E5%86%B3-nf_conntrack-table-full-dropping-packet-%E7%9A%84%E5%87%A0%E7%A7%8D%E6%80%9D%E8%B7%AF/</a></p>
<p>关于Erlang的一些限制<br><a href="http://youthyblog.com/2014/08/05/erlang%E6%9C%89%E5%85%B3%E6%95%88%E7%8E%87%E7%9A%84%E4%B8%80%E4%BA%9Blimit/" target="_blank" rel="external">http://youthyblog.com/2014/08/05/erlang%E6%9C%89%E5%85%B3%E6%95%88%E7%8E%87%E7%9A%84%E4%B8%80%E4%BA%9Blimit/</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-18T06:21:20.000Z"><a href="/2015/03/18/angular-if-else-statement-in-template/">2015-03-18</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/18/angular-if-else-statement-in-template/">AngularJS中的If..Else语句</a></h1>
  

    </header>
    <div class="entry">
      


        


        <ol>
<li><a href="http://docs.angularjs.org/api/ng.directive%3angSwitch" target="_blank" rel="external">ng-switch</a> directive:</li>
</ol>
<p>can be used something like the following.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch</span> <span class="attribute">on</span>=<span class="value">"video"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-when</span>=<span class="value">"video.large"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- code to render a large video block--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-default</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- code to render the regular video block --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><a href="http://docs.angularjs.org/api/ng.directive%3angHide" target="_blank" rel="external">ng-hide</a> / <a href="http://docs.angularjs.org/api/ng.directive%3angShow" target="_blank" rel="external">ng-show</a> directives</li>
</ol>
<p>Alternatively, you might also use <code>ng-show/ng-hide</code> but using this will actually render both a large video and a small video element and then hide the one that meets the <code>ng-hide</code> condition and shows the one that meets <code>ng-show</code> condition.</p>
<p>So on each page you’ll actually be rendering two different elements.</p>
<ol>
<li>Another option to consider is <a href="http://docs.angularjs.org/api/ng.directive%3angClass" target="_blank" rel="external">ng-class</a> directive.</li>
</ol>
<p>This can be used as follows.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-class</span>=<span class="value">"&#123;large-video: video.large&#125;"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- video block goes here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The above basically will add a <code>large-video</code> css class to the div element if <code>video.large</code> is truthy.</p>
<p>UPDATE: <a href="http://code.angularjs.org/1.1.5/docs/" target="_blank" rel="external">Angular 1.1.5</a> introduced the <a href="http://docs.angularjs.org/api/ng.directive%3angIf" target="_blank" rel="external">ngIf directive</a></p>
<ol>
<li>ng-if directive:</li>
</ol>
<p>In the versions above <code>1.1.5</code> you can use the <code>ng-if</code> directive. This would remove the element if the expression provided returns <code>false</code> and re-inserts the <code>element</code> in the DOM if the expression returns <code>true</code>. Can be used as follows.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-if</span>=<span class="value">"video == video.large"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- code to render a large video block--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-if</span>=<span class="value">"video != video.large"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- code to render the regular video block --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="参考资料">参考资料</h2><ol>
<li><a href="http://stackoverflow.com/questions/15810278/if-else-statement-in-angularjs-templates" target="_blank" rel="external">http://stackoverflow.com/questions/15810278/if-else-statement-in-angularjs-templates</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-18T06:18:01.000Z"><a href="/2015/03/18/continuous-deployment-of-node-js-applications/">2015-03-18</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/18/continuous-deployment-of-node-js-applications/">Nodejs应用程序持续部署</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="文章">文章</h2><ol>
<li><p>Continuous Deployment of Node.js Applications<br><a href="http://blog.risingstack.com/continuous-deployment-of-node-js-applications" target="_blank" rel="external">http://blog.risingstack.com/continuous-deployment-of-node-js-applications</a></p>
</li>
<li><p>Best Practices for Deploying Node.js in Production<br><a href="https://strongloop.com/strongblog/node-js-deploy-production-best-practice" target="_blank" rel="external">https://strongloop.com/strongblog/node-js-deploy-production-best-practice</a></p>
</li>
</ol>
<h2 id="持续部署工具">持续部署工具</h2><ol>
<li>Strider<br><a href="http://stridercd.com" target="_blank" rel="external">http://stridercd.com</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-17T15:51:53.000Z"><a href="/2015/03/17/erlang-pooler/">2015-03-17</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/17/erlang-pooler/">Erlang Pooler</a></h1>
  

    </header>
    <div class="entry">
      


        


        <h2 id="参考资料">参考资料</h2><ol>
<li><a href="http://erlangcentral.org/the-pooler-story-how-i-learned-otp-by-writing-a-connection-pool" target="_blank" rel="external">http://erlangcentral.org/the-pooler-story-how-i-learned-otp-by-writing-a-connection-pool</a></li>
<li><a href="https://github.com/bfrog/hottub" target="_blank" rel="external">https://github.com/bfrog/hottub</a></li>
<li><a href="http://sourceforge.net/projects/erlpool/" target="_blank" rel="external">http://sourceforge.net/projects/erlpool/</a></li>
<li><a href="http://www.cnblogs.com/--00/p/4287209.html" target="_blank" rel="external">http://www.cnblogs.com/--00/p/4287209.html</a></li>
<li><a href="http://www.cnblogs.com/--00/p/4281938.html" target="_blank" rel="external">http://www.cnblogs.com/--00/p/4281938.html</a></li>
<li><a href="http://www.cnblogs.com/--00/tag/Erlang/" target="_blank" rel="external">http://www.cnblogs.com/--00/tag/Erlang/</a></li>
<li><a href="http://learnyousomeerlang.com/building-applications-with-otp" target="_blank" rel="external">http://learnyousomeerlang.com/building-applications-with-otp</a></li>
<li><a href="http://www.lshift.net/blog/2010/03/29/on-the-limits-of-concurrency-worker-pools-in-erlang/" target="_blank" rel="external">http://www.lshift.net/blog/2010/03/29/on-the-limits-of-concurrency-worker-pools-in-erlang/</a></li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-16T16:23:38.000Z"><a href="/2015/03/17/ejabberd-easy-installer-and-structure-for-ejabberd-contributed-modules/">2015-03-17</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/17/ejabberd-easy-installer-and-structure-for-ejabberd-contributed-modules/">Ejabberd模块安装工具</a></h1>
  

    </header>
    <div class="entry">
      


        


        <p>从Ejabberd版本<a href="https://github.com/processone/ejabberd/commit/aa1250a3ddf952119982970acc8a743dda6c1041" target="_blank" rel="external">15.02.77 (aa1250a)</a>起,支持通过<code>ejabberdctl</code>命令行工具安装<a href="https://github.com/processone/ejabberd-contrib" target="_blank" rel="external">第三方模块</a></p>
<ul>
<li>如果你之前从源码便已过Ejabberd,并且是从源码安装的, 请首先重新执行如下命令:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./autogen.sh&#10;./configure --enable-mysql \&#10;    --enable-iconv \&#10;    --enable-elixir \&#10;    --enable-tools \&#10;    --enable-nif \&#10;    --enable-odbc \&#10;    --enable-zlib \&#10;    --enable-json&#10;make&#10;make install</span><br></pre></td></tr></table></figure>
<ul>
<li>更新模块列表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ejabberdctl modules_update_specs</span><br></pre></td></tr></table></figure>
<ul>
<li>列出可用的模块</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@xmpp:~# ejabberdctl modules_available&#10;atom_pubsub         Provides access to all PEP nodes via an AtomPub interface&#10;ejabberd_auth_http  Authentication via HTTP request&#10;ircd                IRC server frontend to ejabberd&#10;mod_admin_extra     Additional ejabberd commands&#10;mod_archive         Supports almost all the XEP-0136 version 0.6 except otr&#10;mod_cron            Execute scheduled commands&#10;mod_log_chat        Logging chat messages in text files&#10;mod_logsession      Log session connections to file&#10;mod_logxml          Log XMPP packets to XML file&#10;mod_mam&#9;Message     Archive Management (XEP-0313)&#10;mod_message_log     Log one line per message transmission in text file&#10;mod_muc_admin       Administrative features for MUC&#10;mod_muc_log_http    Serve MUC logs on the web&#10;mod_multicast       Extended Stanza Addressing (XEP-0033) support&#10;mod_openid          Transform the Jabber Server in an openid provider&#10;mod_post_log        Logs messages to an HTTP API&#10;mod_profile         User Profile (XEP-0154) in Mnesia table&#10;mod_rest            HTTP interface to POST stanzas into ejabberd&#10;mod_s2s_log         Log all s2s connections in a file&#10;mod_shcommands      Execute shell commands&#10;mod_statsdx         Calculates and gathers statistics actively&#10;mod_webpresence     Publish user presence information in the web</span><br></pre></td></tr></table></figure>
<ul>
<li>安装一个模块</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ejabberdctl module_install mod_cron</span><br></pre></td></tr></table></figure>
<p>该命令从<a href="https://github.com/processone/ejabberd-contrib" target="_blank" rel="external">ejabberd-contrib</a>仓库安装<code>mod_cron</code>模块</p>
<p><code>$HOME/.ejabberd-modules/mod_cron/conf/mod_cron.yml</code></p>
<h2 id="原文">原文</h2><p><a href="https://blog.process-one.net/easy-installer-and-structure-for-ejabberd-contributed-modules" target="_blank" rel="external">https://blog.process-one.net/easy-installer-and-structure-for-ejabberd-contributed-modules</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-12T16:17:23.000Z"><a href="/2015/03/13/ejabberd-howto-20150312/">2015-03-13</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/13/ejabberd-howto-20150312/">Ejabberd Howto 20150312 &lt;TODO LIST&gt;</a></h1>
  

    </header>
    <div class="entry">
      


        


        <ul>
<li><p>如何使用15.02中新增的Websocket?</p>
<p>  <a href="https://github.com/processone/ejabberd/search?utf8=%E2%9C%93&amp;q=websocket" target="_blank" rel="external">https://github.com/processone/ejabberd/search?utf8=%E2%9C%93&amp;q=websocket</a></p>
</li>
<li><p>新增的SM(Session Manager)数据库后端有什么用处?</p>
<p>  <a href="https://github.com/processone/ejabberd/commit/72d9b099c6a8c73c691cb45ba9e422d69fb55db8#" target="_blank" rel="external">https://github.com/processone/ejabberd/commit/72d9b099c6a8c73c691cb45ba9e422d69fb55db8#</a></p>
</li>
<li><p>如何使用新增的集群脚本?</p>
<p>  <a href="https://github.com/processone/ejabberd/tree/master/tools" target="_blank" rel="external">https://github.com/processone/ejabberd/tree/master/tools</a></p>
</li>
<li><p>如何配置和使用<a href="https://github.com/processone/ejabberd-contrib" target="_blank" rel="external">ejabberd-modules</a>仓库中的模块?</p>
<p>  <a href="https://github.com/processone/ejabberd/commit/f77622067b80bd0e75400f7f5e4b1ae5f6884e8d" target="_blank" rel="external">https://github.com/processone/ejabberd/commit/f77622067b80bd0e75400f7f5e4b1ae5f6884e8d</a></p>
</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <!--<div class="icon"></div>-->
        <time datetime="2015-03-12T13:13:41.000Z"><a href="/2015/03/12/ejabberd-performance-turning/">2015-03-12</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/12/ejabberd-performance-turning/">Ejabberd 性能调优(草稿)</a></h1>
  

    </header>
    <div class="entry">
      


        
        <div id="toc" class="toc-article">
            <strong class="toc-title">文章目录</strong>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第一阶段"><span class="toc-number">1.</span> <span class="toc-text">第一阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#进程打开文件数限制"><span class="toc-number">2.</span> <span class="toc-text">进程打开文件数限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动参数"><span class="toc-number">3.</span> <span class="toc-text">启动参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内核参数调整"><span class="toc-number">4.</span> <span class="toc-text">内核参数调整</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#排查"><span class="toc-number">5.</span> <span class="toc-text">排查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mnesia表过载"><span class="toc-number">6.</span> <span class="toc-text">Mnesia表过载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Erlang_虚拟机参数"><span class="toc-number">7.</span> <span class="toc-text">Erlang 虚拟机参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内核参数"><span class="toc-number">8.</span> <span class="toc-text">内核参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP"><span class="toc-number">8.1.</span> <span class="toc-text">TCP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">9.</span> <span class="toc-text">参考资料</span></a></li></ol>
        </div>
        


        <h2 id="第一阶段">第一阶段</h2><p>目标10W并发连接</p>
<h2 id="进程打开文件数限制">进程打开文件数限制</h2><ol>
<li>编辑 <code>/etc/pam.d/login</code>,取消<code>pam_limits.so</code>的注释</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Sets up user limits according to /etc/security/limits.conf&#10;# (Replaces the use of /etc/limits in old login)&#10;session    required   pam_limits.so</span><br></pre></td></tr></table></figure>
<ol>
<li><code>/etc/security/limits.conf</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root    soft    nofile  320000&#10;root    hard    nofile  320000</span><br></pre></td></tr></table></figure>
<p>我们在root账户下测试, 如何验证该设置是否生效?</p>
<p>exit 退出shell, 重新登录执行<code>ulimit -a</code>查看<code>open files</code>是否为<code>320000</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ci:~# ulimit -a&#10;core file size          (blocks, -c) 0&#10;data seg size           (kbytes, -d) unlimited&#10;scheduling priority             (-e) 0&#10;file size               (blocks, -f) unlimited&#10;pending signals                 (-i) 127413&#10;max locked memory       (kbytes, -l) 64&#10;max memory size         (kbytes, -m) unlimited&#10;open files                      (-n) 320000&#10;pipe size            (512 bytes, -p) 8&#10;POSIX message queues     (bytes, -q) 819200&#10;real-time priority              (-r) 0&#10;stack size              (kbytes, -s) 8192&#10;cpu time               (seconds, -t) unlimited&#10;max user processes              (-u) 127413&#10;virtual memory          (kbytes, -v) unlimited&#10;file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure>
<h2 id="启动参数">启动参数</h2><p>Ejabberd的启动参数可以在配置文件<code>/etc/ejabberd/ejabberdctl.cfg</code>中进行调整</p>
<ul>
<li><p><code>ERL_MAX_PORTS</code></p>
<p>  每个到客户端(s2c)和服务器(s2s)的连接消耗一个<code>port</code>, <code>ERL_MAX_PORTS</code>定义了Ejabberd可以支持的并发连接数. 其可以在配置文件<code>/etc/ejabberd/ejabberdctl.cfg</code>中指定, 默认值为<code>32000</code>.</p>
<p>  大并发连接场景下的应用需要增大该参数的值.</p>
</li>
<li><p><code>ERL_PROCESSES</code></p>
<p>  Erlang消耗很多轻量级进程, 如果Ejabberd比较繁忙, 可能会达到进程数上限, 这种情况会导致高延迟. 当消息延迟过高时, 需要判断是否是由于该参数引起的.</p>
</li>
</ul>
<h2 id="内核参数调整">内核参数调整</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_syncookies = 1&#10;net.ipv4.tcp_tw_reuse = 1&#10;net.ipv4.tcp_tw_recycle = 0&#10;net.ipv4.tcp_timestamps = 1&#10;net.ipv4.tcp_max_syn_backlog = 65535&#10;net.ipv4.tcp_fin_timeout = 30&#10;net.ipv4.tcp_rmem = 4096 4096 16777216&#10;net.ipv4.tcp_wmem = 4096 4096 16777216&#10;net.ipv4.ip_local_port_range = 1025 65000&#10;fs.file-max = 65535000&#10;net.core.rmem_max = 16777216&#10;net.core.wmem_max = 16777216&#10;net.ipv4.tcp_rmem = 4096 87380 16777216&#10;net.ipv4.tcp_wmem = 4096 65536 16777216&#10;net.core.netdev_max_backlog = 30000&#10;net.ipv4.tcp_mtu_probing = 1</span><br></pre></td></tr></table></figure>
<p>内核网络参数<code>net.ipv4.ip_local_port_range</code>指定了本地程序可以打开的端口范围. <code>61000-32768=28232</code>可以最多建立28232个到Ejabberd服务器的连接, 一般比这个数字小, 系统还有其他程序需要占用端口.</p>
<ul>
<li><code>net.ipv4.tcp_tw_recycle = 1</code> 快速回收TCP连接, 避免TIME_WAIT时间过长</li>
</ul>
<p>修改端口范围<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1024 65535 &#62; /proc/sys/net/ipv4/ip_local_port_range</span><br></pre></td></tr></table></figure></p>
<h2 id="排查">排查</h2><ul>
<li>查看ulimit</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -a</span><br></pre></td></tr></table></figure>
<ul>
<li>验证进程的最大可打开文件 <code>Max open files</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@scm:~# cat /proc/18938/limits&#10;Limit                     Soft Limit           Hard Limit           Units&#10;Max cpu time              unlimited            unlimited            seconds&#10;Max file size             unlimited            unlimited            bytes&#10;Max data size             unlimited            unlimited            bytes&#10;Max stack size            8388608              unlimited            bytes&#10;Max core file size        0                    unlimited            bytes&#10;Max resident set          unlimited            unlimited            bytes&#10;Max processes             127460               127460               processes&#10;Max open files            60000                60000                files&#10;Max locked memory         65536                65536                bytes&#10;Max address space         unlimited            unlimited            bytes&#10;Max file locks            unlimited            unlimited            locks&#10;Max pending signals       127460               127460               signals&#10;Max msgqueue size         819200               819200               bytes&#10;Max nice priority         0                    0&#10;Max realtime priority     0                    0&#10;Max realtime timeout      unlimited            unlimited            us</span><br></pre></td></tr></table></figure>
<h2 id="Mnesia表过载">Mnesia表过载</h2><p>编辑配置文件<code>/etc/ejabberd/ejabberdctl.cfg</code>, 设置选项:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERL_OPTIONS=&#34;-mnesia dump_log_write_threshold 50000 -mnesia dc_dump_limit 40&#34;</span><br></pre></td></tr></table></figure>
<p>当前版本的SHELL脚本有BUG, 需要使用<code>\</code>转义, 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERL_OPTIONS=&#34;-mnesia\ dump_log_write_threshold\ 50000\ -mnesia\ dc_dump_limit\ 40&#34;</span><br></pre></td></tr></table></figure>
<h2 id="Erlang_虚拟机参数">Erlang 虚拟机参数</h2><p><a href="http://www.cnblogs.com/lulu/p/4132278.html" target="_blank" rel="external">http://www.cnblogs.com/lulu/p/4132278.html</a></p>
<ul>
<li>beam 启动参数<ul>
<li><code>+sbt db</code><br>  绑定调度器与CPU的亲缘性</li>
<li><code>+P 2000000</code><br>  进程数限制（合适即可）</li>
<li><code>+K true</code><br>  启用epoll</li>
<li><code>+sbwt none</code><br>  关闭beam 调度器 spinlock，降低CPU</li>
<li><code>+swt low</code><br>  提高调度器唤醒灵敏度，避免长时间运行睡死问题</li>
</ul>
</li>
</ul>
<h2 id="内核参数">内核参数</h2><h3 id="TCP">TCP</h3><p><a href="http://blog.csdn.net/russell_tao/article/details/18711023" target="_blank" rel="external">http://blog.csdn.net/russell_tao/article/details/18711023</a></p>
<h2 id="参考资料">参考资料</h2><ol>
<li><p>文件描述符<br><a href="http://erlangcentral.org/wiki/index.php?title=Introduction_to_Load_Testing_with_Tsung#Max_open_file_descriptor_limit" target="_blank" rel="external">http://erlangcentral.org/wiki/index.php?title=Introduction_to_Load_Testing_with_Tsung#Max_open_file_descriptor_limit</a></p>
</li>
<li><p>虚拟接口<br><a href="http://erlangcentral.org/wiki/index.php?title=Introduction_to_Load_Testing_with_Tsung#Virtual_interfaces" target="_blank" rel="external">http://erlangcentral.org/wiki/index.php?title=Introduction_to_Load_Testing_with_Tsung#Virtual_interfaces</a></p>
</li>
<li><p>Mnesia过载问题<br><a href="http://blog.include.io/archives/106" target="_blank" rel="external">http://blog.include.io/archives/106</a><br><a href="http://www.tuicool.com/articles/rIBbqa" target="_blank" rel="external">http://www.tuicool.com/articles/rIBbqa</a></p>
</li>
<li><p>Tsung 常见问题<br><a href="http://tsung.erlang-projects.org/user_manual/faq.html" target="_blank" rel="external">http://tsung.erlang-projects.org/user_manual/faq.html</a></p>
</li>
<li><p><a href="http://blog.fnil.net/index.php/archives/276/" target="_blank" rel="external">http://blog.fnil.net/index.php/archives/276/</a></p>
</li>
<li><p>幻灯片-安装过程(需要梯子)<br><a href="http://www.slideshare.net/ngocdaothanh/tsung-13985127?related=1" target="_blank" rel="external">http://www.slideshare.net/ngocdaothanh/tsung-13985127?related=1</a></p>
</li>
<li><p>Performance Tuning<br><a href="https://www.ejabberd.im/tuning" target="_blank" rel="external">https://www.ejabberd.im/tuning</a></p>
</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div>
    </div>
    <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/11/11/ejabberd-http-module/">开发一个Ejabberd HTTP模块</a>
      </li>
    
      <li>
        <a href="/2015/11/02/elixir-failover-and-takeover/">故障转移和接管</a>
      </li>
    
      <li>
        <a href="/2015/09/17/ejabberd-with-elixir-mix/">用Elixir Mix构建Ejabberd发行包</a>
      </li>
    
      <li>
        <a href="/2015/06/05/uftp/">UFTP - 基于UDP的加密文件多播传输协议</a>
      </li>
    
      <li>
        <a href="/2015/06/04/html5-web-cryptography-api-hashing/">Web加密API - 散列(Hashing)</a>
      </li>
    
      <li>
        <a href="/2015/06/04/the-3-modes-of-http-protocol/">HTTP协议的三种模式</a>
      </li>
    
      <li>
        <a href="/2015/05/21/ejabberd-with-elixir-packet-filters/">Ejabberd 用Elixir开发一个包过滤模块</a>
      </li>
    
      <li>
        <a href="/2015/05/18/chrome-dev-get-started/">Chrome 开发入门</a>
      </li>
    
      <li>
        <a href="/2015/05/18/html5-web-cryptography-api-tutorial/">Web加密API指南</a>
      </li>
    
      <li>
        <a href="/2015/05/17/html5-battery-status/">HTML5获取电池状态</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/AD/">AD</a><small>2</small></li>
  
    <li><a href="/categories/API/">API</a><small>3</small></li>
  
    <li><a href="/categories/Chrome/">Chrome</a><small>1</small></li>
  
    <li><a href="/categories/Continuous-Deployment/">Continuous Deployment</a><small>1</small></li>
  
    <li><a href="/categories/Database/">Database</a><small>1</small></li>
  
    <li><a href="/categories/Docker/">Docker</a><small>9</small></li>
  
    <li><a href="/categories/Ejabberd/">Ejabberd</a><small>36</small></li>
  
    <li><a href="/categories/Elixir/">Elixir</a><small>42</small></li>
  
    <li><a href="/categories/Erlang/">Erlang</a><small>20</small></li>
  
    <li><a href="/categories/HTML5/">HTML5</a><small>3</small></li>
  
    <li><a href="/categories/HTTP/">HTTP</a><small>1</small></li>
  
    <li><a href="/categories/HTTP2/">HTTP2</a><small>1</small></li>
  
    <li><a href="/categories/Javascript/">Javascript</a><small>14</small></li>
  
    <li><a href="/categories/Linux/">Linux</a><small>4</small></li>
  
    <li><a href="/categories/MySQL/">MySQL</a><small>2</small></li>
  
    <li><a href="/categories/Node-js/">Node.js</a><small>17</small></li>
  
    <li><a href="/categories/Opencart/">Opencart</a><small>2</small></li>
  
    <li><a href="/categories/QA/">QA</a><small>2</small></li>
  
    <li><a href="/categories/RESTFul/">RESTFul</a><small>1</small></li>
  
    <li><a href="/categories/SCM/">SCM</a><small>5</small></li>
  
    <li><a href="/categories/Testing/">Testing</a><small>1</small></li>
  
    <li><a href="/categories/Thrift/">Thrift</a><small>1</small></li>
  
    <li><a href="/categories/Tools/">Tools</a><small>4</small></li>
  
    <li><a href="/categories/Web/">Web</a><small>6</small></li>
  
    <li><a href="/categories/XEP/">XEP</a><small>5</small></li>
  
    <li><a href="/categories/XMPP/">XMPP</a><small>7</small></li>
  
    <li><a href="/categories/english/">english</a><small>1</small></li>
  
    <li><a href="/categories/杂类/">杂类</a><small>1</small></li>
  
  </ul>
</div>


  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/AD/" style="font-size: 10px;">AD</a> <a href="/tags/API/" style="font-size: 11.11px;">API</a> <a href="/tags/Analysis/" style="font-size: 10px;">Analysis</a> <a href="/tags/Battery-Status/" style="font-size: 10px;">Battery Status</a> <a href="/tags/Behaviour/" style="font-size: 10px;">Behaviour</a> <a href="/tags/CUPS/" style="font-size: 10px;">CUPS</a> <a href="/tags/CURL/" style="font-size: 10px;">CURL</a> <a href="/tags/Chrome/" style="font-size: 10px;">Chrome</a> <a href="/tags/Clustering/" style="font-size: 10px;">Clustering</a> <a href="/tags/Distributed/" style="font-size: 10px;">Distributed</a> <a href="/tags/Distributed-Application/" style="font-size: 10px;">Distributed Application</a> <a href="/tags/ETS/" style="font-size: 10px;">ETS</a> <a href="/tags/Ecto/" style="font-size: 11.11px;">Ecto</a> <a href="/tags/Elixir/" style="font-size: 20px;">Elixir</a> <a href="/tags/Erlang/" style="font-size: 10px;">Erlang</a> <a href="/tags/Escalus/" style="font-size: 10px;">Escalus</a> <a href="/tags/ExUnit/" style="font-size: 10px;">ExUnit</a> <a href="/tags/Exrm/" style="font-size: 10px;">Exrm</a> <a href="/tags/H2O/" style="font-size: 10px;">H2O</a> <a href="/tags/Hex-pm/" style="font-size: 10px;">Hex.pm</a> <a href="/tags/HiPE/" style="font-size: 10px;">HiPE</a> <a href="/tags/Howto/" style="font-size: 10px;">Howto</a> <a href="/tags/Http-modes/" style="font-size: 10px;">Http modes</a> <a href="/tags/Httpotion/" style="font-size: 10px;">Httpotion</a> <a href="/tags/I18n/" style="font-size: 10px;">I18n</a> <a href="/tags/IAB/" style="font-size: 10px;">IAB</a> <a href="/tags/ID3/" style="font-size: 10px;">ID3</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/IOT/" style="font-size: 10px;">IOT</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/Loopback/" style="font-size: 12.22px;">Loopback</a> <a href="/tags/MUC/" style="font-size: 10px;">MUC</a> <a href="/tags/Macro/" style="font-size: 12.22px;">Macro</a> <a href="/tags/Memcache/" style="font-size: 10px;">Memcache</a> <a href="/tags/Mix/" style="font-size: 14.44px;">Mix</a> <a href="/tags/Modules/" style="font-size: 10px;">Modules</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/OSM-Building/" style="font-size: 10px;">OSM Building</a> <a href="/tags/OTP/" style="font-size: 12.22px;">OTP</a> <a href="/tags/OpenStreetMap/" style="font-size: 10px;">OpenStreetMap</a> <a href="/tags/Optimization/" style="font-size: 10px;">Optimization</a> <a href="/tags/PM2/" style="font-size: 10px;">PM2</a> <a href="/tags/Performance/" style="font-size: 10px;">Performance</a> <a href="/tags/Phoenix/" style="font-size: 12.22px;">Phoenix</a> <a href="/tags/Pool/" style="font-size: 10px;">Pool</a> <a href="/tags/PostgreSQL/" style="font-size: 10px;">PostgreSQL</a> <a href="/tags/RESTFUL/" style="font-size: 11.11px;">RESTFUL</a> <a href="/tags/RMAL/" style="font-size: 10px;">RMAL</a> <a href="/tags/Ranch/" style="font-size: 10px;">Ranch</a> <a href="/tags/RefactorErl/" style="font-size: 10px;">RefactorErl</a> <a href="/tags/Regex/" style="font-size: 10px;">Regex</a> <a href="/tags/Resource-Pool/" style="font-size: 10px;">Resource Pool</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SSL/" style="font-size: 10px;">SSL</a> <a href="/tags/SemVer/" style="font-size: 10px;">SemVer</a> <a href="/tags/Semantic-UI/" style="font-size: 10px;">Semantic UI</a> <a href="/tags/Sequelize/" style="font-size: 10px;">Sequelize</a> <a href="/tags/Stream-Management/" style="font-size: 10px;">Stream Management</a> <a href="/tags/Sublime/" style="font-size: 10px;">Sublime</a> <a href="/tags/Task/" style="font-size: 10px;">Task</a> <a href="/tags/Thrift/" style="font-size: 11.11px;">Thrift</a> <a href="/tags/Tsung/" style="font-size: 10px;">Tsung</a> <a href="/tags/UBF/" style="font-size: 10px;">UBF</a> <a href="/tags/UFTP/" style="font-size: 10px;">UFTP</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/Umbrella/" style="font-size: 10px;">Umbrella</a> <a href="/tags/VAST/" style="font-size: 10px;">VAST</a> <a href="/tags/VPAID/" style="font-size: 10px;">VPAID</a> <a href="/tags/Web-Cryptography-API/" style="font-size: 11.11px;">Web Cryptography API</a> <a href="/tags/XEP/" style="font-size: 16.67px;">XEP</a> <a href="/tags/XEP-198/" style="font-size: 10px;">XEP-198</a> <a href="/tags/XML/" style="font-size: 10px;">XML</a> <a href="/tags/XMPP/" style="font-size: 17.78px;">XMPP</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/angular/" style="font-size: 16.67px;">angular</a> <a href="/tags/application/" style="font-size: 10px;">application</a> <a href="/tags/blockies/" style="font-size: 10px;">blockies</a> <a href="/tags/bootstrap3/" style="font-size: 10px;">bootstrap3</a> <a href="/tags/bosh/" style="font-size: 12.22px;">bosh</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/container/" style="font-size: 11.11px;">container</a> <a href="/tags/data-management/" style="font-size: 10px;">data management</a> <a href="/tags/data-volume/" style="font-size: 10px;">data volume</a> <a href="/tags/debugging/" style="font-size: 10px;">debugging</a> <a href="/tags/devtools/" style="font-size: 10px;">devtools</a> <a href="/tags/devtools-terminal/" style="font-size: 10px;">devtools-terminal</a> <a href="/tags/doc/" style="font-size: 10px;">doc</a> <a href="/tags/docker/" style="font-size: 15.56px;">docker</a> <a href="/tags/ejabberd/" style="font-size: 18.89px;">ejabberd</a> <a href="/tags/ejabberd-c2s/" style="font-size: 10px;">ejabberd_c2s</a> <a href="/tags/emysql/" style="font-size: 11.11px;">emysql</a> <a href="/tags/encoding/" style="font-size: 10px;">encoding</a> <a href="/tags/erlang/" style="font-size: 12.22px;">erlang</a> <a href="/tags/erlang-mk/" style="font-size: 10px;">erlang.mk</a> <a href="/tags/faq/" style="font-size: 10px;">faq</a> <a href="/tags/gen-tcp/" style="font-size: 10px;">gen_tcp</a> <a href="/tags/gerrit/" style="font-size: 11.11px;">gerrit</a> <a href="/tags/gettext/" style="font-size: 10px;">gettext</a> <a href="/tags/git/" style="font-size: 12.22px;">git</a> <a href="/tags/graphviz/" style="font-size: 10px;">graphviz</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hero/" style="font-size: 10px;">hero</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/iconutil/" style="font-size: 10px;">iconutil</a> <a href="/tags/iq/" style="font-size: 10px;">iq</a> <a href="/tags/jabber/" style="font-size: 10px;">jabber</a> <a href="/tags/javascript/" style="font-size: 11.11px;">javascript</a> <a href="/tags/jiffy/" style="font-size: 10px;">jiffy</a> <a href="/tags/json-schema/" style="font-size: 10px;">json-schema</a> <a href="/tags/library/" style="font-size: 10px;">library</a> <a href="/tags/linking/" style="font-size: 10px;">linking</a> <a href="/tags/lists/" style="font-size: 10px;">lists</a> <a href="/tags/load-balance/" style="font-size: 10px;">load balance</a> <a href="/tags/log4er/" style="font-size: 10px;">log4er</a> <a href="/tags/manage-images/" style="font-size: 10px;">manage images</a> <a href="/tags/mariadb/" style="font-size: 10px;">mariadb</a> <a href="/tags/muc/" style="font-size: 10px;">muc</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/node-reggie/" style="font-size: 10px;">node-reggie</a> <a href="/tags/node-webkit/" style="font-size: 13.33px;">node-webkit</a> <a href="/tags/node-js/" style="font-size: 12.22px;">node.js</a> <a href="/tags/nodemailer/" style="font-size: 10px;">nodemailer</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/npm/" style="font-size: 11.11px;">npm</a> <a href="/tags/performance/" style="font-size: 10px;">performance</a> <a href="/tags/ploymer/" style="font-size: 10px;">ploymer</a> <a href="/tags/polymer/" style="font-size: 10px;">polymer</a> <a href="/tags/port/" style="font-size: 10px;">port</a> <a href="/tags/pubsub/" style="font-size: 10px;">pubsub</a> <a href="/tags/rebar/" style="font-size: 10px;">rebar</a> <a href="/tags/record/" style="font-size: 10px;">record</a> <a href="/tags/recursion/" style="font-size: 10px;">recursion</a> <a href="/tags/regexp/" style="font-size: 10px;">regexp</a> <a href="/tags/relx/" style="font-size: 10px;">relx</a> <a href="/tags/screen/" style="font-size: 10px;">screen</a> <a href="/tags/sequelize/" style="font-size: 10px;">sequelize</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/stanza/" style="font-size: 10px;">stanza</a> <a href="/tags/strophe-js/" style="font-size: 10px;">strophe.js</a> <a href="/tags/strophejs/" style="font-size: 10px;">strophejs</a> <a href="/tags/svg-sprite/" style="font-size: 10px;">svg-sprite</a> <a href="/tags/swagger/" style="font-size: 12.22px;">swagger</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a> <a href="/tags/tls/" style="font-size: 10px;">tls</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/tsung/" style="font-size: 10px;">tsung</a> <a href="/tags/upstart/" style="font-size: 10px;">upstart</a> <a href="/tags/vQmod/" style="font-size: 10px;">vQmod</a> <a href="/tags/varnish/" style="font-size: 10px;">varnish</a> <a href="/tags/vqmod/" style="font-size: 10px;">vqmod</a> <a href="/tags/vt/" style="font-size: 10px;">vt</a> <a href="/tags/win32reg/" style="font-size: 10px;">win32reg</a> <a href="/tags/xml-schema/" style="font-size: 10px;">xml schema</a> <a href="/tags/匆匆那年/" style="font-size: 10px;">匆匆那年</a> <a href="/tags/协议包/" style="font-size: 10px;">协议包</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
</div>
<footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 zhiqiang he
  
</div>
<div class="clearfix"></div></footer>

<!--<script src="http://libs.baidu.com/jquery/2.0.3/jquery.min.js"></script>-->
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<!--<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });

</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });

</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });

</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-53429135-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>




